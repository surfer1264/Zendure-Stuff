[
    {
        "id": "479e3443afedb613",
        "type": "tab",
        "label": "Nulleinspeisung",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8cb3e48299bf05a3",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(6.1) Hilfe: DeBug On/Off / nur f√ºr Testzwecke",
        "style": {
            "label": true
        },
        "nodes": [
            "4c8b09952269dd08",
            "1a20522aef689bfc",
            "8168c7cbdb038c4d"
        ],
        "x": 994,
        "y": 1799,
        "w": 452,
        "h": 142
    },
    {
        "id": "4cd6e76302eb583f",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(4.1) Auf √Ñnderungen am Frontend reagieren",
        "style": {
            "label": true
        },
        "nodes": [
            "e9f9cd15a6862c4e",
            "c84c098c6effed96",
            "7d4c4e86e4f55c0e",
            "0e480ca221581f95",
            "9e746fb7159e492c",
            "3449af90d583c750",
            "468aa5952345cfac",
            "40a4a90fc6cbd15d",
            "1b49fc372d8175f7",
            "7a4cdab88b37efa4",
            "ba6605545cfdfb18",
            "26c46f28a4782ba1",
            "6453649fc9e5f5f0",
            "5cfcf573718eb3d5",
            "f6f5cf5f1e5c7c22",
            "af7cb14005ad7208",
            "9bcffdcf2913b47b",
            "15951ffac0a8ed47",
            "b2900737df35050a",
            "31aef1593af4b0d7",
            "5e173fb39bf8170d",
            "4bb62780a37020ed"
        ],
        "x": 194,
        "y": 2519,
        "w": 1252,
        "h": 362
    },
    {
        "id": "fdb0ce097a97065d",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(1.1) Initialisierung: Konfiguration von Dashboard √ºbernehmen",
        "style": {
            "label": true,
            "fill": "#ffffbf"
        },
        "nodes": [
            "0b1e18818ad83899",
            "914b9236075d8b71",
            "0265e5a3515f9ff8",
            "180ce22f05ebcd8b",
            "7d5cc8f2e1131191",
            "6fb0045e8cdc267c",
            "7097e2efb7e186dc",
            "f07808beb37f2be1",
            "7b4e9c68d230dfef",
            "f5ac4859d53b8c34",
            "23e4362f7e76ec9f",
            "404d1730801695a8",
            "108e0ec12c031ce4",
            "9467d9f7df48e4e5",
            "edcb9390f933d4b7",
            "1a09bce668c12667",
            "b4b07729dd9d31ee",
            "f64a874c50bdf191",
            "a63607adfff3fead",
            "141f0ec3aa515c27"
        ],
        "x": 194,
        "y": 19,
        "w": 1012,
        "h": 442
    },
    {
        "id": "0ebb8e7b772678cd",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(7.1) Wechselrichter: Ansteuern",
        "style": {
            "label": true,
            "fill": "#c8e7a7"
        },
        "nodes": [
            "60df30044c929c46",
            "5496fa05034dd5e0",
            "13971ddb6ad995e2",
            "54372a43b72a9c3a",
            "fc7613a47a09c1a6",
            "7f5bc6e47b11df44",
            "0d452cdc92314b7d",
            "09573f0766e9b699"
        ],
        "x": 1614,
        "y": 1899,
        "w": 1112,
        "h": 182
    },
    {
        "id": "3ce9227ad71245e3",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(8) Testflows",
        "style": {
            "label": true
        },
        "nodes": [
            "e1165b70369f2b1d",
            "3c31d8008dcaffaa",
            "d7ce31319e5242a2",
            "b759be1778ad269d",
            "0245b5a6cd994e5a",
            "02ed511c2d909f2f",
            "da59e0c300a23601",
            "d6568f655d82ddea",
            "46ac14d1f3bb7a07",
            "50b4f58a24c2f256"
        ],
        "x": 188,
        "y": 3933,
        "w": 884,
        "h": 1114
    },
    {
        "id": "acff453100dcbbc9",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(1.2) Initialisierung Termindaten",
        "style": {
            "label": true,
            "fill": "#ffffbf"
        },
        "nodes": [
            "645676e2f7f3e8cf",
            "42fc7acb14089ef4",
            "943544611b67c3df",
            "09dffc974b495c82",
            "43418775b6507be1",
            "958b193833400787",
            "cac27145bbce8069",
            "076b4e7072e40b12",
            "c29538ec26e2ffb7",
            "a0f16c5abc5d653d",
            "25c2c1d8b0140bb9",
            "2717c849e2440723",
            "b9477af5c2654795"
        ],
        "x": 554,
        "y": 479,
        "w": 652,
        "h": 422
    },
    {
        "id": "035acd6f5889242d",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(4.2) Auf √Ñnderungen im Frondend reagieren, Terminmodus",
        "style": {
            "label": true
        },
        "nodes": [
            "95aae71aad83e480",
            "b5bf8bcda7423569",
            "fa86dfe1511e4782",
            "e80f0135fcd06711",
            "e00a8abfacced21e",
            "d3744680f9123907",
            "85470c3b214d6856",
            "5720bb584469a627",
            "8b8f010a71a323a4",
            "a9a461cbb8765f2b",
            "7da3b1748f25fccc",
            "8126e6438578eab3",
            "f76cb1b980c3bdf2",
            "924fcf53aa0acbdc",
            "5a619949abdec684",
            "b9d168c1fa77f22a"
        ],
        "x": 194,
        "y": 2899,
        "w": 1248,
        "h": 322
    },
    {
        "id": "6e708c215cdbfc98",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(5.2) Terminmodus: Steuerung, Pr√ºfe Termine",
        "style": {
            "label": true
        },
        "nodes": [
            "46d329ad8dd32a6a",
            "f8a44280bd222a9e",
            "77e722feaad4dffe",
            "3d36f3e8b8cb3fe0",
            "4a0e658896e45770"
        ],
        "x": 194,
        "y": 3379,
        "w": 1248,
        "h": 348
    },
    {
        "id": "3b8b8c73f8c2f645",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(5.3) Spezial: Was passiert wenn der Terminmodus on/off?",
        "style": {
            "label": true
        },
        "nodes": [
            "fca9127a7f61a1b8",
            "e6ea1346bc547904",
            "5dd4fe71b0a47034",
            "2b9f6a16b9c71e0b"
        ],
        "x": 194,
        "y": 3739,
        "w": 832,
        "h": 142
    },
    {
        "id": "fa899eab480fd056",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(5.1) Terminmodus: AktiverTermin wird gesetzt bei Terminwechsel",
        "style": {
            "label": true
        },
        "nodes": [
            "d5eeaf058038c14e",
            "cbe6d62869a9bbe6"
        ],
        "x": 194,
        "y": 3279,
        "w": 692,
        "h": 82
    },
    {
        "id": "b5ff1f69caf7f3fb",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(6.2) Hilfe: Fange Fehler",
        "style": {
            "label": true
        },
        "nodes": [
            "304c27e2b8253ddc",
            "75c29f28532e7a32",
            "ec50ae1b2f62c5ed",
            "fa35dabff235479a",
            "294af22fccee50c1",
            "c731caca09ad7220",
            "0a77a411bae6d6a8"
        ],
        "x": 2774,
        "y": 1899,
        "w": 872,
        "h": 182
    },
    {
        "id": "b6cbd1ee551c690b",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(7.2) Wechselrichter an Oberfl√§che AN/AUS",
        "style": {
            "label": true
        },
        "nodes": [
            "4119817686335d91",
            "3f310be62393785c",
            "df520bc5a9c771f0",
            "6772ff6019665b83",
            "05397794624406c5",
            "8a4a05751fdc343f",
            "367af67087a908a8",
            "3b9421d90a4b9fd3",
            "2986171de753aadb",
            "113787982a56301f",
            "d75f80acac58c46f",
            "88f0ebf6669abe2f",
            "2901366668454020",
            "a3802b99388a73e1",
            "30471465b9e6510f",
            "36f3252fb4621270",
            "9c35e52d51caca37",
            "7893c8dbb115ef93",
            "02ecee97db19ba57",
            "318c162604820738"
        ],
        "x": 1614,
        "y": 2159,
        "w": 1712,
        "h": 362
    },
    {
        "id": "46a88bad508d3778",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(2) Reglerfunktion",
        "style": {
            "label": true,
            "stroke": "#ff0000",
            "fill": "#e3f3d3",
            "color": "#ff0000"
        },
        "nodes": [
            "1",
            "3",
            "168148af37ed1368",
            "68c44e68d8a62aa4",
            "5110fa7591c84b6b",
            "bae021af7ad4d4ea",
            "240b1ea3948dee0a",
            "1f11ef02984634d4",
            "db71458988a0ae4a",
            "4f2a4b1d2bb4a50a",
            "82e6e623f87b357b",
            "66a15f5adc0815dc",
            "be89d5ddb5c4de40",
            "7e065cdfb6cd92bd",
            "f6b17c0a7515dc64",
            "78dbc119241bb5d0",
            "3f77c130efc4805a",
            "d8febfbf64f9a1dc",
            "f539cfde4411e802"
        ],
        "x": 194,
        "y": 1959,
        "w": 1252,
        "h": 368
    },
    {
        "id": "0ded3f6e0d781a4e",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(1.3) Initialisierung Ausgang",
        "style": {
            "label": true,
            "fill": "#ffffbf"
        },
        "nodes": [
            "df27770545d213b5",
            "dd3a208eb767c579",
            "df1e2cb0ac09ba12",
            "7d0404303c8fad6d",
            "51239912e3877c4d",
            "039ee9a7ab711a33",
            "d9fb180bd5fd6ff8",
            "7d73a67d14204ea2",
            "cf998755e26fe945",
            "f95d4fe5b1ba92c3",
            "e01d8fa50d01f508",
            "2945df02bcac2061",
            "0a94c4e6766e62c9",
            "4cb2b580c2b15ca9",
            "5429a937f7d4fe2f",
            "a0b4a6e2b0bd2354",
            "2f8099592faddc79"
        ],
        "x": 194,
        "y": 973,
        "w": 1258,
        "h": 814,
        "info": "# hkhjk\r\n|Regler Auswahl| Smart Modus Typ 5|SYSTEM Aus |WR Typ1 (EZ1)|WR Typ2 (HMS) | WR Typ4 Man|\r\n|---|---|---|---|---|---|\r\n|Bedeutung|Smarte Leistungssteuerung der Z-HA Integration aktiv|Regelsystem komplett AUS|Absolute Ansteuerung eines WR|relative Ansteuerung eines WR|manuelle Leistungssteuerung der Z-HA Integration aktiv|\r\n|WR Hersteller | | |ABS |REL | |\r\n| | | | | | |\r\n|**Sensor** | | | | | |\r\n|Regler Algorithmis aktiv |off |off |on |on |on |\r\n|Zendure Manager Betriebsmodus |smart |off |off |off |manuell |\r\n|Regler WR Aus |on | | | | |\r\n|WR Typ 1 |wrmax |wrmax |80 | |wrmax |\r\n|WR Typ 2 |wrmax |wrmax | |80/wrmax*100 |wrmax/wrmax*100  |\r\n|WR Typ 4 | | | | |80    |"
    },
    {
        "id": "0a438837db6c47d2",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "Service: Morgentliche und abendliche Initialisierung",
        "style": {
            "label": true,
            "stroke": "#92d04f"
        },
        "nodes": [
            "72932590259c2eb2",
            "313a12776bf9f44c",
            "c59bd969b0f7900c",
            "caf11d3b06226cb7",
            "3f3b4e5f643e30d1"
        ],
        "x": 1628,
        "y": 813,
        "w": 1264,
        "h": 954
    },
    {
        "id": "e504044664a57b4e",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "Monitor: Verf√ºgbarkeiten von Sensoren pr√ºfen",
        "style": {
            "stroke": "#ff0000",
            "label": true
        },
        "nodes": [
            "4e7901031e717127",
            "70cc64c2bba0fbd9"
        ],
        "x": 1628,
        "y": 33,
        "w": 964,
        "h": 494
    },
    {
        "id": "33fc19028d8c92bf",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(6.3) Nach jedem Restart eine Init-Logzeile schreiben",
        "style": {
            "label": true
        },
        "nodes": [
            "19c87395473efe5b",
            "63174e4704cb40ac",
            "01c5ad8c136ab28c",
            "1f6df3bd52dc3303"
        ],
        "x": 194,
        "y": 1799,
        "w": 752,
        "h": 142
    },
    {
        "id": "d0a61549998e4f87",
        "type": "group",
        "z": "479e3443afedb613",
        "name": "(3.2)  wenn der Reglungsalgorithmus ausgeschaltet wird?",
        "style": {
            "label": true
        },
        "nodes": [
            "c64e656e48de4e43",
            "118030ec66a767e8",
            "e646756010d9f10c",
            "512302055eac88b8"
        ],
        "x": 194,
        "y": 2339,
        "w": 1252,
        "h": 122
    },
    {
        "id": "3f3b4e5f643e30d1",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0a438837db6c47d2",
        "name": "(1.8) Forecast Tomorrow auswerten und Entladegrenze ggf. justieren",
        "style": {
            "label": true
        },
        "nodes": [
            "3ac00ebeea2b8c5c",
            "939f0aa5e8a71cef",
            "2d12daef02c4c242",
            "7e2bbff3fbeba74f",
            "e4d3edfa3d38398d",
            "91a6dcfc70106acb",
            "fedc91bc44cbd434",
            "62532c236f10aa32",
            "b41f6643294c0f56"
        ],
        "x": 1654,
        "y": 1579,
        "w": 1212,
        "h": 162
    },
    {
        "id": "b759be1778ad269d",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "Verf√ºgbarkeit WR pr√ºfen",
        "style": {
            "label": true
        },
        "nodes": [
            "e3472deef8161dec",
            "2f8986cbd151a9ec",
            "6b62e9f5107a01db",
            "2dc24ace9b912ba2"
        ],
        "x": 214,
        "y": 4679,
        "w": 812,
        "h": 142
    },
    {
        "id": "d7ce31319e5242a2",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "Nachricht an Messenger schicken",
        "style": {
            "label": true
        },
        "nodes": [
            "270cd10ad54ddfd0",
            "2569cad207b467f7",
            "4f98968ddf42865a"
        ],
        "x": 214,
        "y": 4939,
        "w": 792,
        "h": 82
    },
    {
        "id": "46ac14d1f3bb7a07",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "Shelly auslesen ",
        "style": {
            "label": true
        },
        "nodes": [
            "3c38f71e3abb6567",
            "5a942abc7cd65d2e",
            "bdf7929968ea7a52",
            "5439dc35407ecda1"
        ],
        "x": 214,
        "y": 4579,
        "w": 802,
        "h": 82
    },
    {
        "id": "4e7901031e717127",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "e504044664a57b4e",
        "name": "(3.3.) Monitor:  Wenn der Shelly3EM ausf√§llt...oder der Solarflow Offline ist",
        "style": {
            "label": true
        },
        "nodes": [
            "b39b705f55bc143a",
            "354e9d385e0e7a12",
            "7a5d3ef92442a929",
            "8556d367c4b1fac5",
            "a62ebd85d47fee9f",
            "750f877240f66bc6",
            "b1f2ddda67ab1775",
            "557b88a08fb680ad",
            "8546724667636606",
            "1bdd52ee74cd6023",
            "f6d4dc83056b836e",
            "c4baeda9f9677e08"
        ],
        "x": 1654,
        "y": 59,
        "w": 912,
        "h": 222,
        "info": "## Verbindungsverlust Shelly 3EM\r\nDer Shelly 3EM verliert manchmal seine Verbindung\r\n\r\ndann:\r\n - wird der WR-Ausgang  auf 80W gesetzt (auf einen sinnvollen Grundlastwert)\r\n - die Regelfunktion `ReglerAktiv=off` au√üer Kraft gesetzt\r\n - der WR-AUsgang angesteuert\r\n\r\nWenn der SHelly wieder online ist,\r\n\r\ndann:\r\n - die Regelfunktion `ReglerAktiv=on` gesetzt\r\n - werden alle Variablen des gesamten FLows erneut initialisiert.\r\n"
    },
    {
        "id": "70cc64c2bba0fbd9",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "e504044664a57b4e",
        "name": "(3.6) Monitor: Verf√ºgbarkit der Shellys melden",
        "style": {
            "label": true
        },
        "nodes": [
            "9b85d89c5ecbfb58",
            "93030162d5c5a12c",
            "03ed40ed26dd3a65",
            "d99b35c545ee754a",
            "919fb03d28bf7aba",
            "59f3b95dd2f0e022",
            "b78e47bc659c68e6"
        ],
        "x": 1654,
        "y": 319,
        "w": 912,
        "h": 182
    },
    {
        "id": "72932590259c2eb2",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0a438837db6c47d2",
        "name": "(1.4) Service: Setze SF-Entladegrenze nach Monat",
        "style": {
            "label": true,
            "color": "#777777",
            "stroke": "#777777"
        },
        "nodes": [
            "959c8c911e7fde10",
            "10a5947e7b0e4bba",
            "ee79553e2bee0ac5",
            "fd9ffa19de35ef1b",
            "40cd311eb34f8bec",
            "3a896cce6e31964b",
            "98eedc884b02a91c"
        ],
        "x": 1654,
        "y": 839,
        "w": 952,
        "h": 202
    },
    {
        "id": "e1165b70369f2b1d",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "Hoymiles testen / relative Ansteuerung",
        "style": {
            "label": true
        },
        "nodes": [
            "ee29490c9c4b5005",
            "041e921ba09a57a6",
            "3c960d972905ddd8"
        ],
        "x": 214,
        "y": 3959,
        "w": 752,
        "h": 82
    },
    {
        "id": "3c31d8008dcaffaa",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "APSysem EZ1 testen / absolute Ansteuerung",
        "style": {
            "label": true
        },
        "nodes": [
            "e2258c6eea29d2b9",
            "e7e9befaa8453b4d",
            "0ec176a2fa37ecc0"
        ],
        "x": 214,
        "y": 4059,
        "w": 752,
        "h": 82
    },
    {
        "id": "7d73a67d14204ea2",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Smart Modus der Z-HA Integration",
        "style": {
            "label": true,
            "fill": "#e3f3d3"
        },
        "nodes": [
            "68eb3e92f051ff26",
            "b2f2791b82ef1fd9",
            "d36943bed8f6d1b6"
        ],
        "x": 294,
        "y": 1559,
        "w": 272,
        "h": 202
    },
    {
        "id": "d8febfbf64f9a1dc",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Shelly1PM Abfrage",
        "style": {
            "label": true
        },
        "nodes": [
            "2c22eb5a28b88af3",
            "76f6c97f59e020a9"
        ],
        "x": 254,
        "y": 2159,
        "w": 292,
        "h": 142
    },
    {
        "id": "cf998755e26fe945",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "HA-Implementierung daktivieren: AUS",
        "style": {
            "label": true
        },
        "nodes": [
            "f14903b8d8cafcf6",
            "69c9aaf49d7fabba",
            "ea244f2be20330ad",
            "9d7ca67058014a92"
        ],
        "x": 594,
        "y": 1559,
        "w": 292,
        "h": 202
    },
    {
        "id": "0a94c4e6766e62c9",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Outputlimit Hub auf SFMax setzen",
        "style": {
            "label": true
        },
        "nodes": [
            "80276a25567d0ce3",
            "5c36c0c1bfabe8e7"
        ],
        "x": 934,
        "y": 1259,
        "w": 472,
        "h": 82
    },
    {
        "id": "4cb2b580c2b15ca9",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Wechselrichter Grenze auf MAX setzen",
        "style": {
            "label": true
        },
        "nodes": [
            "f81801a182e992f9",
            "ae2d81258bd8fae4",
            "bd67f151a7c8bdbe",
            "9e26b0c7a7787d25"
        ],
        "x": 934,
        "y": 1359,
        "w": 472,
        "h": 202
    },
    {
        "id": "5429a937f7d4fe2f",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Initialisiere die WR mit 80W (Typ1 und 2)",
        "style": {
            "label": true
        },
        "nodes": [
            "b79ae4256daf27f6",
            "e6c67233c1c5b911"
        ],
        "x": 954,
        "y": 999,
        "w": 452,
        "h": 82
    },
    {
        "id": "a0b4a6e2b0bd2354",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Initialisiere Man-Leist.steuerung mit 80W",
        "style": {
            "label": true
        },
        "nodes": [
            "44725bc13c3d9599",
            "bf65d001e486db67",
            "ec84cf4771cfbcac"
        ],
        "x": 934,
        "y": 1599,
        "w": 492,
        "h": 122
    },
    {
        "id": "313a12776bf9f44c",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0a438837db6c47d2",
        "name": "(1.6) Service: Kalibriere SOLL-Werte der Regelung zum Sonnenuntergang",
        "style": {
            "label": true
        },
        "nodes": [
            "d8aad289353f949c",
            "bb94db99200bab27",
            "1cfab2d550d339ae",
            "f251eebcf0f8ca69",
            "f5fa4b9134667e5d"
        ],
        "x": 1654,
        "y": 1219,
        "w": 952,
        "h": 142
    },
    {
        "id": "c59bd969b0f7900c",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0a438837db6c47d2",
        "name": "(1.7) Service: Setze Maxeinspeisung auf Wert X, wenn Soclevel einen Wert unterschreitet",
        "style": {
            "label": true
        },
        "nodes": [
            "7b996172714a688c",
            "1fdeb8e2804338d9",
            "9d729c1d1740d366",
            "3c0eb024a9b6d28a",
            "15c60a8cea285214",
            "f27d62e96ecd8f9c",
            "f7f1469c0b78556d",
            "9c6d4b41b2750d05",
            "1327d2c0642ca6cc"
        ],
        "x": 1654,
        "y": 1399,
        "w": 1212,
        "h": 142
    },
    {
        "id": "3d36f3e8b8cb3fe0",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "6e708c215cdbfc98",
        "name": "Pr√ºfe ob Soc= 100% dann Bypass=1",
        "style": {
            "label": true
        },
        "nodes": [
            "e962ca54b4872db1",
            "c74815a7ace7eac8"
        ],
        "x": 274,
        "y": 3619,
        "w": 452,
        "h": 82
    },
    {
        "id": "caf11d3b06226cb7",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "0a438837db6c47d2",
        "name": "(1.5)  Counter Regleraktionen zur√ºcksetzen",
        "style": {
            "label": true
        },
        "nodes": [
            "7c51c28aa24b93a7",
            "e3ec4bb870c8a50a",
            "095d2bf993964117"
        ],
        "x": 1654,
        "y": 1079,
        "w": 952,
        "h": 122
    },
    {
        "id": "4a0e658896e45770",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "6e708c215cdbfc98",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b521fd91073a57a3",
            "ca349456294f5c38",
            "9c1f091862872c3f",
            "5485cb51b64e87ef",
            "722460ce5b6e1c2d",
            "d77905c6e4e680d6"
        ],
        "x": 674,
        "y": 3459,
        "w": 742,
        "h": 142
    },
    {
        "id": "b9d168c1fa77f22a",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "17d9fef67944a9b4",
            "0d56421cb0e22b14",
            "f9c28e57357fbedd",
            "909de9d9437f09c6",
            "2d86efd2574df8ec",
            "652351a92f1a3d4b"
        ],
        "x": 674,
        "y": 2999,
        "w": 742,
        "h": 142
    },
    {
        "id": "0245b5a6cd994e5a",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "APSysem EZ1 testen / absolute Ansteuerung mit √úbergabe Sensorname",
        "style": {
            "label": true
        },
        "nodes": [
            "e25dd8e781b3f57d",
            "91570a4c78376cef",
            "1c1b6369a59eabbe"
        ],
        "x": 214,
        "y": 4159,
        "w": 812,
        "h": 82
    },
    {
        "id": "02ed511c2d909f2f",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "EInen Hoymiles (Relative Ansteuerung) setzen",
        "style": {
            "label": true
        },
        "nodes": [
            "ac712f39db9196a3",
            "0a3fd6bcfaa113dc",
            "8670dc77189b5b5f"
        ],
        "x": 214,
        "y": 4479,
        "w": 832,
        "h": 82
    },
    {
        "id": "da59e0c300a23601",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "EInen Shelly per HTTP Request auslesen",
        "style": {
            "label": true
        },
        "nodes": [
            "2940a6546713a79a",
            "3c8cabaa304bd745",
            "6bd08e9d0b68c8e0",
            "a056e94e32dc397e"
        ],
        "x": 214,
        "y": 4379,
        "w": 752,
        "h": 82
    },
    {
        "id": "d6568f655d82ddea",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "Hole Daten eines Sensors, der in einer Variable definiert ist (hier der Einspeisesensor)",
        "style": {
            "label": true
        },
        "nodes": [
            "fc9dbf8b3b334185",
            "bb929c7f2e0a7c3f",
            "e452733f940cf159"
        ],
        "x": 214,
        "y": 4259,
        "w": 752,
        "h": 82
    },
    {
        "id": "50b4f58a24c2f256",
        "type": "group",
        "z": "479e3443afedb613",
        "g": "3ce9227ad71245e3",
        "name": "(3.7) AdHoc Message an Messenger schicken",
        "style": {
            "label": true
        },
        "nodes": [
            "a10e19704f6f0128",
            "3405486d31eae70f",
            "6510f41ac1c3a100"
        ],
        "x": 214,
        "y": 4839,
        "w": 812,
        "h": 82
    },
    {
        "id": "1",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Alle 5 Sekunden",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "x": 330,
        "y": 2000,
        "wires": [
            [
                "168148af37ed1368",
                "7e065cdfb6cd92bd"
            ]
        ]
    },
    {
        "id": "3",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "P-Regler",
        "func": "let debug = flow.get(\"Debug\");\nlet wrmax = flow.get (\"WRLeistung\"); //max. WR Leistung in W\nlet wrmin = flow.get(\"WRminLeistung\"); //min WR Leistung in W\nlet soll = flow.get (\"Sollwert\"); //Sollwert in W\nlet grenze = flow.get (\"MaxEinspeisung\") || wrmax; //max. Einspeisung in W\nlet minimal = flow.get(\"MinEinspeisung\") || wrmin;; //Mindest Einspeisung\nlet hyst = global.get (\"Hysterese\") || 15;  // Hysterese-Bereich in W\nlet kp = flow.get (\"Reglerkp\")|| 1; //D√§mpfungsfaktor\nlet repeat = flow.get(\"WRRepeat\") || 0;\nlet vorher = flow.get(\"Regelwert\"); ////letzte Einstellung des WR laden\n\n//Hole aktuellen Verbrauchswert vom Shelly3EM RPC Abfrage\nlet leistung = Number(Number(msg.payload.total_act_power).toFixed(1));\nflow.set (\"3em\" , leistung);\n\n// Hole aktuelle Verbrauchswerte vom Shelly3EM event Knoten \n// let leistung = Number(msg.payload);\n\n//Wie gro√ü ist die Abweichung von Soll und Hysterese?\nlet fehler = (Math.abs(leistung - soll) > hyst) ? Math.round(soll - leistung) : 0;\nflow.set(\"fehler\", fehler);\n\n// Absolutue Abweichung ist der fehler\n// wenn fehler negativ, dann mit D√§mpfung (kp) hochfahren\n// wenn fehler positiv, dann so schnell wie m√∂glich Einspeisung zur√ºcknehmen\nlet delta = (fehler < 0) ? kp * fehler : fehler;\n\n// Neue WR-Begrenzung berechnen\nlet neu = Math.round(vorher - delta);\n\n// Begrenzung auf g√ºltige Werte zwischen WRmin (geschlossen) oder WRmax (offen) kalibrieren\nneu = Math.max(Math.max(wrmin, minimal), Math.min( wrmax, neu));\n\n// Ber√ºcksichtige eine m√∂gliche Einspeise-Begrenzung\n// Wenn neuer Regelwert, dann setzte Regelwert, wenn Regelwert gr√∂√üer Begrenzung, dann Setzte ¬¥Begrenzung\nneu = Math.min(neu, grenze);\nflow.set(\"Regelwert\", neu);\n    \n//Wenn sich der Reglewert nicht g√§ndert hat: Ignore\nlet diff = neu - vorher; \nif (debug) {\n    node.warn(`Leistung=${leistung}, Fehler=${fehler}, Neu=${neu}, Vorher=${vorher}, Diff=${diff}, Grenze=${grenze}, Repeat=${repeat}`);\n}\n\nnode.status({\n  text: `Regelwert: ${neu} | Repeat: ${repeat}`\n});\nsetTimeout(() => node.status({}), 5000);\n\n//wenn das Regelsignal sich nicht ver√§ndert (diff = 0)  soll der Wechselrichter nicht angesprochen werden.\n//Falls das Regelsignal nicht beim WR durch kommt (aus welchen Gr√ºnden auch immer) und sich gleichzeitig aber auch nicht mehr √§ndert\n//bleibt die Regelung im Zweifel h√§ngen. \n//Ein Z√§hler stellt sicher, dass der WR regel√§m√üig angesprochen wird (else Pfad), dabei wird der Einspeisewert leicht ver√§ndert um eine Rejusrierung zu erreichen.\nif (diff !== 0)\n    {\n    flow.set(\"WRRepeat\", 0);\n    msg.payload = {einspeisewert: neu};\n    return msg;\n    }\n\nrepeat++;\nflow.set(\"WRRepeat\", repeat);\n\nif (repeat >= 72) {\n    if (neu <= wrmax && neu > wrmin) {\n        neu = Math.max(wrmin, neu - (2 * hyst));\n        flow.set(\"Regelwert\", neu);\n    }\n    if (neu <= wrmin) {\n        neu = neu + (2 * hyst);\n        flow.set (\"Regelwert\", neu);\n    }\n    flow.set(\"WRRepeat\", 0);\n    msg.payload = { einspeisewert: neu };\n    return msg;\n}\nreturn;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 2180,
        "wires": [
            [
                "68c44e68d8a62aa4",
                "240b1ea3948dee0a"
            ]
        ]
    },
    {
        "id": "4c8b09952269dd08",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "8cb3e48299bf05a3",
        "name": "üîõ Debug EIN",
        "props": [
            {
                "p": "debug",
                "v": "true",
                "vt": "bool"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1120,
        "y": 1840,
        "wires": [
            [
                "8168c7cbdb038c4d"
            ]
        ]
    },
    {
        "id": "1a20522aef689bfc",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "8cb3e48299bf05a3",
        "name": "üî¥ Debug AUS",
        "props": [
            {
                "p": "debug",
                "v": "false",
                "vt": "bool"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1120,
        "y": 1900,
        "wires": [
            [
                "8168c7cbdb038c4d"
            ]
        ]
    },
    {
        "id": "8168c7cbdb038c4d",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "8cb3e48299bf05a3",
        "name": "Setze flow.debug",
        "rules": [
            {
                "t": "set",
                "p": "Debug",
                "pt": "flow",
                "to": "debug",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1330,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "e9f9cd15a6862c4e",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable hysterese",
        "func": "let regler_hysterese = msg.payload;\nglobal.set(\"Hysterese\", regler_hysterese);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 2560,
        "wires": [
            []
        ]
    },
    {
        "id": "c84c098c6effed96",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Hysterese?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_hysterese"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 2560,
        "wires": [
            [
                "e9f9cd15a6862c4e"
            ]
        ]
    },
    {
        "id": "0b1e18818ad83899",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "hyst",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_hysterese",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "hyst",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 60,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "914b9236075d8b71",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "soll",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_sollwert",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "soll",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 100,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "0265e5a3515f9ff8",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "aktiv",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_aktiv",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "aktiv",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 140,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "180ce22f05ebcd8b",
        "type": "join",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": false,
        "timeout": "",
        "count": "10",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1010,
        "y": 140,
        "wires": [
            [
                "7d5cc8f2e1131191"
            ]
        ]
    },
    {
        "id": "7d5cc8f2e1131191",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "Flowvariablen setzen",
        "func": "//Konfiguration aus dem dem Dashboard initial √ºbernehmen\nconst { hyst, soll, max, aktiv, last, wraktiv, ignore, typ, minimal, connected} = msg.payload;\nlet wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\"); \nglobal.set(\"Hysterese\", hyst);\nflow.set(\"Sollwert\", soll);\nflow.set(\"MaxEinspeisung\", Math.max(wrmin,Math.min(wrmax,max)));\nflow.set(\"MaxEinspeisungSave\", Math.max(wrmin,Math.min(wrmax,max)));\nflow.set(\"MinEinspeisung\", Math.max(wrmin, minimal));\nflow.set(\"ReglerAktiv\", aktiv);\nflow.set(\"AktiverTermin\", last);\nglobal.set(\"WRAktiv\", wraktiv);\nflow.set(\"IgnoreBypass\", ignore);\nflow.set(\"ReglerTyp\", typ);\nflow.set(\"Connected\", connected);\nflow.set(\"WRRepeat\",0);\n//node.warn (max);\n//Internal Used\nflow.set(\"Regelwert\", 70);\nflow.set(\"Debug\", false);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "6fb0045e8cdc267c",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "max",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_maximale_einspeisung",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "max",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 180,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "7d4c4e86e4f55c0e",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Regelung Aktiv?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_aktiv"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 330,
        "y": 2600,
        "wires": [
            [
                "0e480ca221581f95"
            ]
        ]
    },
    {
        "id": "0e480ca221581f95",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable Regler aktiv",
        "func": "let aktiv = msg.payload;\nflow.set(\"ReglerAktiv\", aktiv);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 2600,
        "wires": [
            []
        ]
    },
    {
        "id": "9e746fb7159e492c",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Max Power?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_maximale_einspeisung"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 320,
        "y": 2640,
        "wires": [
            [
                "3449af90d583c750"
            ]
        ]
    },
    {
        "id": "3449af90d583c750",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable Max Power",
        "func": "let wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\");\n//flow.set (\"Regelwert\", msg.payload); \nflow.set(\"MaxEinspeisung\", Math.max(wrmin,Math.min(msg.payload,wrmax)));\nlet max = flow.get(\"MaxEinspeisung\");\nnode.status({fill:\"yellow\",shape:\"dot\",text:\"Max \" +max});\nmsg.payload = {einspeisewert: max};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 2640,
        "wires": [
            [
                "5cfcf573718eb3d5"
            ]
        ]
    },
    {
        "id": "468aa5952345cfac",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Sollwert?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_sollwert"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 2680,
        "wires": [
            [
                "40a4a90fc6cbd15d"
            ]
        ]
    },
    {
        "id": "40a4a90fc6cbd15d",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable Sollwert",
        "func": "let soll = msg.payload;\nflow.set(\"Sollwert\", soll);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 2680,
        "wires": [
            []
        ]
    },
    {
        "id": "168148af37ed1368",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Reglung aktiv?",
        "property": "ReglerAktiv",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 320,
        "y": 2060,
        "wires": [
            [
                "db71458988a0ae4a"
            ],
            []
        ]
    },
    {
        "id": "60df30044c929c46",
        "type": "link in",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "link in 7",
        "links": [
            "68c44e68d8a62aa4",
            "1b49fc372d8175f7",
            "9c1f091862872c3f",
            "f9c28e57357fbedd",
            "750f877240f66bc6",
            "e646756010d9f10c"
        ],
        "x": 1655,
        "y": 2000,
        "wires": [
            [
                "09573f0766e9b699"
            ]
        ]
    },
    {
        "id": "68c44e68d8a62aa4",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "link out 16",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 1385,
        "y": 2160,
        "wires": []
    },
    {
        "id": "1b49fc372d8175f7",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "link out 17",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 1405,
        "y": 2660,
        "wires": []
    },
    {
        "id": "5496fa05034dd5e0",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.increment",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_inkrement"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "increment",
        "x": 2270,
        "y": 2000,
        "wires": [
            [
                "7f5bc6e47b11df44"
            ]
        ]
    },
    {
        "id": "5110fa7591c84b6b",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "HIER: Sensor des Smartmeters anpassen",
        "info": "",
        "x": 780,
        "y": 2280,
        "wires": []
    },
    {
        "id": "7097e2efb7e186dc",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "KONFIGURIEREN",
        "func": "// Wechselrichterparameter hier anpassen\n// Maximalleistung, die in der Regelung genutzt werden soll <= WR System Leistung \nflow.set(\"WRLeistung\", 650); //Maxleistung des WR in Watt, die in der Regelung ber√ºcksichtigt werden soll \nflow.set(\"WRminLeistung\", 35); //Minleistung des WR in Watt, ACHTUNG: 0 kann falsch sein und wird von einigen WR nicht angenommen!!\n\n//Es kann ur einen geben: entweder REL oder ABS\nflow.set(\"WRHersteller\", \"ABS\"); //nutze einen WR mit absoluter Ansteuerung in Watt\n//flow.set(\"WRHersteller\", \"REL\"); //nutze einen WR mit relativer Ansteuerung in %\n\n// Maximalleistung am Ausgang des Hubs, die im Hub eingestellt ist; sollte >=WRLeistung sein\nflow.set(\"SFMax\", 700); //SolarflowMax Output der Z-HA Integratiom, hier vorgeben\n\n// nur INFO\nglobal.set (\"Capacity\", 1920); //System Kapzit√§t der Akkus (noch nicht verwendet)\nflow.set (\"Release\", \"4.2.1\"); //nur Info\n\n// Hier die exakten Sensornamen Eurer Ausgabeger√§te eintragen\n// wrtyp wird √ºber das Dashboard ermittelt\n// wrtyp 0: AUS: keine Regelung, Kontrolle durch Hub \n// wrtyp 1: EZ1: APSystemEZ1 f√ºr absolute Einspeisung\n// wrtyp 2: HMS: Hoymiles f√ºr relative Einspeisung\n// wrtyp 3: OUT: Ausgangsleistung Eures des Hubs (nur interne Nutzung, aber wichtig)\n// wrtyp 4: MAN: Zendure Manager Manuelle Leistungssteuerung\n// wrtyp 5: SMT: Zendure Manager Smarte Leistungssteuerung\n// flow.set(\"WRTyp\", 4); //Startkonfiguration / Default\n\n// Achtung typ1 nur f√ºr WR mit absoluter Einspeisung in W\nflow.set (\"wrSensor_typ1\", \"number.solar_maximale_leistung\"); // mein APSystemEZ1 ( WRHersteller \"ABS\")\n// Achtung typ2 nur f√ºr WR mit relativer Einspeisung in %\nflow.set(\"wrSensor_typ2\", \"number.dtu_leistungsbegrenzung\"); // mein HMS800xx ( WRHersteller \"REL\")\n// folgendes wird ben√∂tigt aus der Z-HA Integration\nflow.set (\"wrSensor_typ3\", \"number.solarherwegh_output_limit\"); // Z-HA Integratiom, Sensor f√ºr OUTPUT-Limit des Hubs\nflow.set (\"wrSensor_typ4\", \"number.zendure_manager_manual_power\"); // Z-HA Integratiom, Sensor f√ºr manuelle Leistungssteuerung\nflow.set (\"zHAMinSoCSensor\", \"number.solarherwegh_min_soc\" ); // Z-HA Integration, Sensor f√ºr Entladegrenze\nflow.set (\"electricLevel\", \"sensor.solarherwegh_electric_level\"); // Z-HA Integration, Sensor f√ºr des Ladezustandes der Akkus des Systems\n\n// Hast Du einen Einspeisesensor hinter Deinem Hub?\n// Set to On or Off\nflow.set (\"EinspeiseSensorExist\", \"on\");\nflow.set(\"einspeiseSensor\", \"sensor.solarhub_power\"); // mein ShellyPlus1PM hinterm Hub/Wechselrichter\n\n//Whatsigram Messenger installiert?\n//Setze auf \"on\" wenn installiert, Setze auf \"off\" wenn nicht installiert\nflow.set (\"messenger\", \"on\");\n\n//Empf√§ngername des Dienstes aus der Integration hier einf√ºgen \nglobal.set (\"msgDienst\", \"notify.whatsigram_recipient_1\");\n\n\n// Konfigurationstabelle f√ºr jeden Monat\n// Format: Monat: { Akku_min, Sollwert, MaxEinspeisung }\nconst config = {\n    1:  { akku_min: 40, sollwert: 10, maxeinspeisung: 200 },\n    2:  { akku_min: 30, sollwert: 10, maxeinspeisung: 200 },\n    3:  { akku_min: 20, sollwert:  5, maxeinspeisung: 400 },\n    4:  { akku_min: 20, sollwert:  5, maxeinspeisung: 400 },\n    5:  { akku_min: 15, sollwert:  5, maxeinspeisung: 400 },\n    6:  { akku_min: 14, sollwert:  0, maxeinspeisung: 500 },\n    7:  { akku_min: 14, sollwert:  0, maxeinspeisung: 500 },\n    8:  { akku_min: 14, sollwert:  0, maxeinspeisung: 500 },\n    9:  { akku_min: 15, sollwert:  5, maxeinspeisung: 400 },\n    10: { akku_min: 25, sollwert:  5, maxeinspeisung: 400 },\n    11: { akku_min: 25, sollwert: 10, maxeinspeisung: 300 },\n    12: { akku_min: 40, sollwert: 10, maxeinspeisung: 200 }\n};\nflow.set (\"ConfigValues\", config);\n\n// Minimaleinstellung der Entladegrenze der Akkus\nflow.set (\"AbsoluteMinVol\", 13);\n\n// PV Forecast installiert?\n// Setze auf \"on\" wenn installiert, Setze auf \"off\" wenn nicht installiert oder Nutzung nicht gewollt\n// PV Sensoren\nflow.set(\"PVForecast\", \"on\");\nflow.set(\"PV_tomorrow\", \"sensor.energy_production_tomorrow\");\nflow.set (\"PV_today_remaining\", \"sensor.energy_production_today_remaining\");\n\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 280,
        "wires": [
            [
                "f5ac4859d53b8c34"
            ]
        ]
    },
    {
        "id": "645676e2f7f3e8cf",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Uhrzeit1",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_datetime.regler1",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "date1",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 780,
        "y": 520,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "42fc7acb14089ef4",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Setze Flowvariablen",
        "func": "// Initialisiere\nflow.set(\"Date1\", msg.payload.date1.substring(0,5));\nflow.set(\"Date2\", msg.payload.date2.substring(0,5));\nflow.set(\"Date3\", msg.payload.date3.substring(0,5));\n\nlet wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\");\nflow.set(\"Wert1\", Math.max(wrmin,Math.min(msg.payload.wert1, wrmax)));\nflow.set(\"Wert2\", Math.max(wrmin,Math.min(msg.payload.wert2, wrmax)));\nflow.set(\"Wert3\", Math.max(wrmin,Math.min(msg.payload.wert3, wrmax)));\nflow.set(\"WertBypass\", Math.min(msg.payload.wertbypass, wrmax));\nflow.set(\"Terminmodus\", msg.payload.termin);\nflow.set(\"MinimalEinspeisung\", msg.payload.minimal);\n\n//Bypass Sensor angelegt?, Wenn JA:\n//flow.set(\"Terminmodus\", \"on\");\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "943544611b67c3df",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Uhrzeit2",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_datetime.regler2",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "date2",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 780,
        "y": 600,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "09dffc974b495c82",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Wert1",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_wert1_termin1",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "wert1",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 770,
        "y": 560,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "43418775b6507be1",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Wert2",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_wert2_termin2",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "wert2",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 770,
        "y": 640,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "958b193833400787",
        "type": "join",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": false,
        "timeout": "",
        "count": "8",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1010,
        "y": 560,
        "wires": [
            [
                "42fc7acb14089ef4"
            ]
        ]
    },
    {
        "id": "cac27145bbce8069",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Uhrzeit3",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_datetime.regler3",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "date3",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 780,
        "y": 680,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "076b4e7072e40b12",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Wert3",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_wert3_termin3",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "wert3",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 770,
        "y": 720,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "95aae71aad83e480",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Date2",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_datetime.regler2"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 2980,
        "wires": [
            [
                "5720bb584469a627"
            ]
        ]
    },
    {
        "id": "b5bf8bcda7423569",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Date3",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_datetime.regler3"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 3020,
        "wires": [
            [
                "8b8f010a71a323a4"
            ]
        ]
    },
    {
        "id": "fa86dfe1511e4782",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Date1",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_datetime.regler1"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 2940,
        "wires": [
            [
                "85470c3b214d6856"
            ]
        ]
    },
    {
        "id": "e80f0135fcd06711",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Wert1",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_wert1_termin1"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 3060,
        "wires": [
            [
                "a9a461cbb8765f2b"
            ]
        ]
    },
    {
        "id": "e00a8abfacced21e",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Wert2",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_wert2_termin2"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 3100,
        "wires": [
            [
                "7da3b1748f25fccc"
            ]
        ]
    },
    {
        "id": "d3744680f9123907",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Wert3",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_wert3_termin3"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 270,
        "y": 3140,
        "wires": [
            [
                "8126e6438578eab3"
            ]
        ]
    },
    {
        "id": "85470c3b214d6856",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Date1",
        "func": "flow.set(\"Date1\", msg.payload.substring(0,5));\n//msg.topic = \"Date1\";\n//msg.payload = flow.get(\"Date1\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 2940,
        "wires": [
            []
        ]
    },
    {
        "id": "5720bb584469a627",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Date2",
        "func": "flow.set(\"Date2\", msg.payload.substring(0,5));\n//msg.topic = \"Date2\";\n//msg.payload = flow.get(\"Date2\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 2980,
        "wires": [
            []
        ]
    },
    {
        "id": "8b8f010a71a323a4",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Date3",
        "func": "flow.set(\"Date3\", msg.payload.substring(0,5));\n//msg.topic = \"Date3\";\n//msg.payload = flow.get(\"Date3\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3020,
        "wires": [
            []
        ]
    },
    {
        "id": "a9a461cbb8765f2b",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Wert1",
        "func": "let wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\"); \nflow.set(\"Wert1\", Math.max(wrmin,Math.min(msg.payload,wrmax)));\nmsg.topic = \"Wert1\";\nmsg.payload = flow.get(\"Wert1\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3060,
        "wires": [
            [
                "652351a92f1a3d4b"
            ]
        ]
    },
    {
        "id": "7da3b1748f25fccc",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Wert2",
        "func": "let wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\"); \nflow.set(\"Wert2\", Math.max(wrmin,Math.min(msg.payload,wrmax)));\n//flow.set(\"Wert2\", msg.payload);\nmsg.topic = \"Wert2\";\nmsg.payload = flow.get(\"Wert2\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3100,
        "wires": [
            [
                "652351a92f1a3d4b"
            ]
        ]
    },
    {
        "id": "8126e6438578eab3",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable Wert3",
        "func": "let wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\"); \nflow.set(\"Wert3\", Math.max(wrmin,Math.min(msg.payload,wrmax)));\n//flow.set(\"Wert3\", msg.payload);\nmsg.topic = \"Wert3\";\nmsg.payload = flow.get(\"Wert3\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 3140,
        "wires": [
            [
                "652351a92f1a3d4b"
            ]
        ]
    },
    {
        "id": "f07808beb37f2be1",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 360,
        "wires": [
            [
                "7097e2efb7e186dc"
            ]
        ]
    },
    {
        "id": "46d329ad8dd32a6a",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "6e708c215cdbfc98",
        "name": "aktuelles DateX ermitteln",
        "func": "// Schaltzeiten & Werte (Formate: \"hh:mm\" und number)\nconst dates = [\n    { key: \"Date1\", time: flow.get(\"Date1\"), value: flow.get(\"Wert1\") },\n    { key: \"Date2\", time: flow.get(\"Date2\"), value: flow.get(\"Wert2\") },\n    { key: \"Date3\", time: flow.get(\"Date3\"), value: flow.get(\"Wert3\") }\n];\n\nconst grenze = flow.get(\"MaxEinspeisung\");\nconst ac = flow.get(\"AktiverTermin\");\nconst debug = flow.get(\"Debug\");\n\n// Aktuelle Uhrzeit im Format hh:mm\nconst now = new Date();\nconst timeString = now.toTimeString().slice(0, 5); // z.B. \"14:07\"\n\nif (debug) {\n    node.warn({ grenze, timeString, ac, dates });\n}\n\n// Pr√ºfen, ob aktuelle Zeit einer Schaltzeit entspricht\nconst match = dates.find(d => d.time === timeString);\n\n// match liefert exakt eine Zeile aus dates zur√ºck oder \"undefined\"\nif (match) {\n    flow.set(\"AktiverTermin\", match.key);\n    msg.payload = { aktivertermin: match.key };\n    node.status({ text: `${match.key} | Wert: ${match.value}` });\n    return msg;\n}\n\n// Kein Treffer\nnode.status({ text: `Date: ${ac} | Wert: ${grenze}` });\nreturn;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 3560,
        "wires": [
            [
                "f8a44280bd222a9e",
                "b521fd91073a57a3"
            ]
        ]
    },
    {
        "id": "b521fd91073a57a3",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "Terminmodus an?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_terminmodus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "originalpayload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 3560,
        "wires": [
            [
                "5485cb51b64e87ef",
                "722460ce5b6e1c2d"
            ],
            []
        ]
    },
    {
        "id": "ca349456294f5c38",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "Setze Einspeisegrenze",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_maximale_einspeisung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 1280,
        "y": 3500,
        "wires": [
            []
        ]
    },
    {
        "id": "fca9127a7f61a1b8",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "3b8b8c73f8c2f645",
        "name": "Terminmodus=on?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_terminmodus"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 3800,
        "wires": [
            [
                "2b9f6a16b9c71e0b"
            ],
            [
                "e6ea1346bc547904"
            ]
        ]
    },
    {
        "id": "e6ea1346bc547904",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3b8b8c73f8c2f645",
        "name": "Setze Grenze",
        "func": "//Wenn AUS, dann stelle alten Wert wieder her.\nlet grenze = flow.get (\"MaxEinspeisungSave\"); //max.Einspeisung\nflow.set(\"MaxEinspeisung\",grenze);\nmsg.payload = grenze;\nnode.status({fill:\"yellow\",shape:\"dot\",text:\"Wert: \" +grenze});\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 3840,
        "wires": [
            [
                "5dd4fe71b0a47034"
            ]
        ]
    },
    {
        "id": "5dd4fe71b0a47034",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "3b8b8c73f8c2f645",
        "name": "Setze EInspeisegrenze",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_maximale_einspeisung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 890,
        "y": 3800,
        "wires": [
            []
        ]
    },
    {
        "id": "2b9f6a16b9c71e0b",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3b8b8c73f8c2f645",
        "name": "Save letzte Grenze",
        "func": "//Wenn AN: Sichere die gesetzte MaxEInspeisung des Reglerbetriebes\nlet grenze = flow.get(\"MaxEinspeisung\");\nflow.set(\"MaxEinspeisungSave\",grenze);\n\n//Hole passende EInspeisegrene passend zum Termin\nlet aktiv = flow.get(\"AktiverTermin\");\nlet wert1 = flow.get(\"Wert1\");\nlet wert2 = flow.get(\"Wert2\");\nlet wert3 = flow.get(\"Wert3\");\nlet wert = grenze;\n\nswitch (aktiv)\n    {\n    case \"Date1\":\n        wert = wert1; \n        break\n    case \"Date2\":\n        wert = wert2; \n        break\n    case \"Date3\":\n        wert = wert3; \n        break\n    }\nflow.set(\"MaxEinspeisung\", wert);\nnode.status({\n    text: `Date: ${aktiv} | Wert: ${wert}`\n    });\nmsg.payload = wert;\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 3780,
        "wires": [
            [
                "5dd4fe71b0a47034"
            ]
        ]
    },
    {
        "id": "9c1f091862872c3f",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "link out 19",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 1375,
        "y": 3560,
        "wires": []
    },
    {
        "id": "c29538ec26e2ffb7",
        "type": "link in",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "link in 12",
        "links": [
            "f5ac4859d53b8c34"
        ],
        "x": 595,
        "y": 680,
        "wires": [
            [
                "645676e2f7f3e8cf",
                "09dffc974b495c82",
                "943544611b67c3df",
                "43418775b6507be1",
                "cac27145bbce8069",
                "076b4e7072e40b12",
                "a0f16c5abc5d653d",
                "25c2c1d8b0140bb9",
                "b9477af5c2654795"
            ]
        ]
    },
    {
        "id": "7b4e9c68d230dfef",
        "type": "link in",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "link in 13",
        "links": [
            "f5ac4859d53b8c34",
            "b1f2ddda67ab1775"
        ],
        "x": 655,
        "y": 180,
        "wires": [
            [
                "0b1e18818ad83899",
                "914b9236075d8b71",
                "0265e5a3515f9ff8",
                "6fb0045e8cdc267c",
                "23e4362f7e76ec9f",
                "404d1730801695a8",
                "108e0ec12c031ce4",
                "1a09bce668c12667",
                "b4b07729dd9d31ee",
                "f64a874c50bdf191"
            ]
        ]
    },
    {
        "id": "f5ac4859d53b8c34",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "link out 21",
        "mode": "link",
        "links": [
            "7b4e9c68d230dfef",
            "d9fb180bd5fd6ff8",
            "63174e4704cb40ac",
            "c29538ec26e2ffb7"
        ],
        "x": 565,
        "y": 180,
        "wires": []
    },
    {
        "id": "17d9fef67944a9b4",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "Einspeisgrenze neu setzen",
        "func": "//Welcher Termin ist der Aktive?\nlet ac = flow.get(\"AktiverTermin\"); // Date1 oder Date2 oder Date3\n\nconst wert1 = flow.get(\"Wert1\");\nconst wert2 = flow.get(\"Wert2\");\nconst wert3 = flow.get(\"Wert3\");\nlet wert = flow.get(\"MaxEinspeisung\");\n\n    switch (ac)\n    {\n    case \"Date1\":\n        {\n        wert = wert1;\n        break;\n        }\n    case \"Date2\":\n        {\n        wert = wert2;\n        break;\n        }\n    case \"Date3\":\n        {\n        wert = wert3\n        break;\n        }\n    }\nmsg.payload = {einspeisewert: wert};\nnode.status(`Date=${ac}, Wert=${wert}`);\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 3040,
        "wires": [
            [
                "0d56421cb0e22b14"
            ]
        ]
    },
    {
        "id": "0d56421cb0e22b14",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "Setze Einspeisegrenze",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_maximale_einspeisung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 1280,
        "y": 3040,
        "wires": [
            []
        ]
    },
    {
        "id": "f9c28e57357fbedd",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "link out 22",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 1375,
        "y": 3100,
        "wires": []
    },
    {
        "id": "d5eeaf058038c14e",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "fa899eab480fd056",
        "name": "Termin √§ndert sich (Date x)?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_text.regler_timer_auswahl"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 340,
        "y": 3320,
        "wires": [
            [
                "cbe6d62869a9bbe6"
            ]
        ]
    },
    {
        "id": "cbe6d62869a9bbe6",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "fa899eab480fd056",
        "name": "Speicher Aktiven Termin",
        "func": "let date = msg.payload;\nflow.set (\"AktiverTermin\", date);\nnode.status({fill:\"green\",shape:\"ring\",text:\"Aktiv: \" +date});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 3320,
        "wires": [
            []
        ]
    },
    {
        "id": "f8a44280bd222a9e",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "6e708c215cdbfc98",
        "name": "Aktiver Termin",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_text.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_text.regler_timer_auswahl"
        ],
        "labelId": [],
        "data": "{ \"value\": payload.aktivertermin }",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_text",
        "service": "set_value",
        "x": 760,
        "y": 3420,
        "wires": [
            []
        ]
    },
    {
        "id": "23e4362f7e76ec9f",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "last",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_text.regler_timer_auswahl",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "last",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 220,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "77e722feaad4dffe",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "6e708c215cdbfc98",
        "name": "Jede Minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": "8",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 3440,
        "wires": [
            [
                "46d329ad8dd32a6a",
                "e962ca54b4872db1"
            ]
        ]
    },
    {
        "id": "304c27e2b8253ddc",
        "type": "catch",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Fehler fangen WR schreiben",
        "scope": [
            "7f5bc6e47b11df44"
        ],
        "uncaught": false,
        "x": 2920,
        "y": 1980,
        "wires": [
            [
                "75c29f28532e7a32",
                "fa35dabff235479a",
                "294af22fccee50c1"
            ]
        ]
    },
    {
        "id": "404d1730801695a8",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "wraus",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_wr_aus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "wraktiv",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 260,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "7a4cdab88b37efa4",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Terminmodus?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_terminmodus"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 320,
        "y": 2720,
        "wires": [
            [
                "ba6605545cfdfb18"
            ]
        ]
    },
    {
        "id": "ba6605545cfdfb18",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable Terminmodus",
        "func": "let termin = msg.payload;\nflow.set(\"Terminmodus\", termin);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 2720,
        "wires": [
            []
        ]
    },
    {
        "id": "26c46f28a4782ba1",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change Wechserichter Aktiv?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_wr_aus"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 340,
        "y": 2760,
        "wires": [
            [
                "6453649fc9e5f5f0"
            ]
        ]
    },
    {
        "id": "6453649fc9e5f5f0",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Global Variable WRAktiv",
        "func": "let wraktiv = msg.payload;\nglobal.set(\"WRAktiv\", wraktiv);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 2760,
        "wires": [
            []
        ]
    },
    {
        "id": "13971ddb6ad995e2",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "WRAktiv An?",
        "property": "WRAktiv",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2050,
        "y": 2000,
        "wires": [
            [
                "5496fa05034dd5e0"
            ],
            []
        ]
    },
    {
        "id": "4119817686335d91",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WR EZ1 Aus",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "switch.turn_off",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "switch.solar_wechselrichterstatus"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "switch",
        "service": "turn_off",
        "x": 2750,
        "y": 2420,
        "wires": [
            [
                "02ecee97db19ba57"
            ]
        ]
    },
    {
        "id": "3f310be62393785c",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WR EZ1 ein",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "switch.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "switch.solar_wechselrichterstatus"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "switch",
        "service": "turn_on",
        "x": 2750,
        "y": 2260,
        "wires": [
            [
                "318c162604820738"
            ]
        ]
    },
    {
        "id": "df520bc5a9c771f0",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WR AN/AUS?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_wr_aus"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1930,
        "y": 2380,
        "wires": [
            [
                "05397794624406c5"
            ],
            [
                "8a4a05751fdc343f"
            ]
        ]
    },
    {
        "id": "6772ff6019665b83",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "HIER: WR Sensornamen f√ºr WR Ein/Aus pr√ºfen",
        "info": "",
        "x": 2740,
        "y": 2200,
        "wires": []
    },
    {
        "id": "54372a43b72a9c3a",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "debug 18 (WR)",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1960,
        "y": 2040,
        "wires": []
    },
    {
        "id": "b39b705f55bc143a",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "Shelly3EM ist da?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "device_tracker.wohnung_3em_pro"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1770,
        "y": 240,
        "wires": [
            [
                "1bdd52ee74cd6023"
            ],
            [
                "a62ebd85d47fee9f"
            ]
        ]
    },
    {
        "id": "354e9d385e0e7a12",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "HIER: WR DeviceTracker pr√ºfen",
        "info": "",
        "x": 1810,
        "y": 200,
        "wires": []
    },
    {
        "id": "5cfcf573718eb3d5",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Bypass?",
        "property": "Bypass",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 2640,
        "wires": [
            [],
            [
                "4bb62780a37020ed"
            ]
        ]
    },
    {
        "id": "909de9d9437f09c6",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "Bypass?",
        "property": "Bypass",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1000,
        "y": 3100,
        "wires": [
            [],
            [
                "2d86efd2574df8ec"
            ]
        ]
    },
    {
        "id": "5485cb51b64e87ef",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "Bypass?",
        "property": "Bypass",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1000,
        "y": 3560,
        "wires": [
            [],
            [
                "d77905c6e4e680d6"
            ]
        ]
    },
    {
        "id": "2717c849e2440723",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Setze Flowvariablen",
        "func": "let level = Number(msg.payload[0].state);\n//let level = msg.payload;\nnode.status({fill:\"green\",shape:\"ring\",text:\"SOC: \" +level});\nif (level < 100)\n    {\n    flow.set(\"Bypass\", 0); //1 An; 0: Aus    \n    }\nelse \n    {\n    flow.set(\"Bypass\", 1); //1 An; 0: Aus    \n    }\n ",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "05397794624406c5",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "WRAktiv",
                "pt": "global",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 2280,
        "wires": [
            [
                "2986171de753aadb"
            ]
        ]
    },
    {
        "id": "8a4a05751fdc343f",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "WRAktiv",
                "pt": "global",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 2420,
        "wires": [
            [
                "113787982a56301f"
            ]
        ]
    },
    {
        "id": "7a5d3ef92442a929",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "ReglerAktiv Off",
        "rules": [
            {
                "t": "set",
                "p": "ReglerAktiv",
                "pt": "flow",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2320,
        "y": 240,
        "wires": [
            [
                "750f877240f66bc6"
            ]
        ]
    },
    {
        "id": "8556d367c4b1fac5",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "ReglerAktiv ON",
        "rules": [
            {
                "t": "set",
                "p": "ReglerAktiv",
                "pt": "flow",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2320,
        "y": 140,
        "wires": [
            [
                "b1f2ddda67ab1775"
            ]
        ]
    },
    {
        "id": "a62ebd85d47fee9f",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "Setze WR auf FIX (70W)",
        "func": "msg.payload = {einspeisewert: 70};\nreturn msg; \n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2050,
        "y": 240,
        "wires": [
            [
                "7a5d3ef92442a929"
            ]
        ]
    },
    {
        "id": "750f877240f66bc6",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "link out 23",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 2505,
        "y": 240,
        "wires": []
    },
    {
        "id": "108e0ec12c031ce4",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "ignore",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.ignorebypass",
        "state_type": "habool",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "ignore",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 300,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "f6f5cf5f1e5c7c22",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Change IgnoreBypass",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.ignorebypass"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 320,
        "y": 2840,
        "wires": [
            [
                "af7cb14005ad7208"
            ]
        ]
    },
    {
        "id": "af7cb14005ad7208",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable IgnoreBypass",
        "func": "let ignore = msg.payload;\nflow.set(\"IgnoreBypass\", ignore);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 2840,
        "wires": [
            []
        ]
    },
    {
        "id": "bae021af7ad4d4ea",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "d": true,
        "g": "46a88bad508d3778",
        "name": "Shelly3EM Power",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.shellypro3em_phase_a_active_power",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 770,
        "y": 2260,
        "wires": [
            []
        ]
    },
    {
        "id": "b1f2ddda67ab1775",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "link out 24",
        "mode": "link",
        "links": [
            "7b4e9c68d230dfef"
        ],
        "x": 2505,
        "y": 140,
        "wires": []
    },
    {
        "id": "9b85d89c5ecbfb58",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "Einspeise Plus1PM ist da?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "device_tracker.shellyplus1pm_balkon"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1790,
        "y": 360,
        "wires": [
            [
                "93030162d5c5a12c",
                "919fb03d28bf7aba"
            ],
            [
                "93030162d5c5a12c",
                "919fb03d28bf7aba"
            ]
        ]
    },
    {
        "id": "93030162d5c5a12c",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "Erstelle Nachricht",
        "func": "//const entityId = msg.entity_id;\n//const entityId = msg.data.entity_id;\nconst entityId = msg.topic;\nconst payload = msg.payload;\n\nmsg.payload = {\n    title: \"Status ShellyDevices\",\n    message: `Entity: ${entityId} hat den Status '${payload}' erreicht.`\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2130,
        "y": 360,
        "wires": [
            [
                "03ed40ed26dd3a65"
            ]
        ]
    },
    {
        "id": "03ed40ed26dd3a65",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "Sende Notification",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "notify.persistent_notification",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"title\":\"{{payload.title}}\", \"message\":\"{{payload.message}}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "persistent_notification",
        "target": {},
        "service_domain": "persistent_notification",
        "mergecontext": "",
        "x": 2450,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "d99b35c545ee754a",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "Shelly3EM ist da?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "device_tracker.wohnung_3em_pro"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1810,
        "y": 400,
        "wires": [
            [
                "93030162d5c5a12c",
                "919fb03d28bf7aba"
            ],
            [
                "93030162d5c5a12c",
                "919fb03d28bf7aba"
            ]
        ]
    },
    {
        "id": "75c29f28532e7a32",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Formatieren",
        "func": "\nlet timestamp = new Date().toLocaleString(\"de-DE\");\n\n// --- Erkennen, ob Fehler oder Status ---\nlet isError = msg.error !== undefined;\n\n// --- Felder f√ºr CSV ---\n// Wenn isError true ist ‚Üí wir haben einen Fehlerfall\n// Sonst ‚Üí Initialisierung (kein Fehler)\nlet logType = isError ? \"Error\" : \"Init\";\n\n// Im Fehlerfall: Name des Node aus msg.error.source.name √ºbernehmen\n// Wenn kein Name vorhanden ‚Üí \"unknown\"\n// Sonst (kein Fehler): festen Namen \"System\" setzen\nlet nodeName = isError ? (msg.error?.source?.name || \"unknown\") : \"System\";\n\n// Im Fehlerfall: Node-ID aus msg.error.source.id √ºbernehmen (oder leeren String, falls undefiniert)\n// Sonst leerer String\nlet nodeId = isError ? (msg.error?.source?.id || \"\") : \"\";\n\n// Im Fehlerfall: Node-Typ aus msg.error.source.type √ºbernehmen (oder leerer String)\n// Sonst leerer String\nlet nodeType = isError ? (msg.error?.source?.type || \"\") : \"\";\n\n// Im Fehlerfall: Fehlermeldung aus msg.error.message √ºbernehmen\n// Wenn keine vorhanden ‚Üí \"Unbekannter Fehler\"\n// Sonst (kein Fehler): Erfolgsmeldung \"Initialisierung erfolgreich\"\nlet message = isError ? (msg.error?.message || \"Unbekannter Fehler\") : \"System\";\n\n\n// --- CSV-Zeile zusammenbauen ---\nmsg.payload =\n    `${timestamp};${logType};${nodeName};${nodeId};${nodeType}\\n`;\n// --- Status im Editor anzeigen ---\nnode.status({ text: `${logType} Log geschrieben` });\nsetTimeout(() => node.status({}), 3000);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3210,
        "y": 1980,
        "wires": [
            [
                "ec50ae1b2f62c5ed"
            ]
        ]
    },
    {
        "id": "ec50ae1b2f62c5ed",
        "type": "file",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Fehler Log Schreiben",
        "filename": "/config/debug-log1.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "utf8",
        "x": 3440,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "919fb03d28bf7aba",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "Debug & Log",
        "func": "// Debugnachricht erzeugen\n// node.warn(msg.payload);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2110,
        "y": 420,
        "wires": [
            [
                "59f3b95dd2f0e022"
            ]
        ]
    },
    {
        "id": "59f3b95dd2f0e022",
        "type": "file",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "In Datei schreiben",
        "filename": "/config/debug-log.txt",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 2450,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "240b1ea3948dee0a",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "debug 8",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1340,
        "y": 2280,
        "wires": []
    },
    {
        "id": "557b88a08fb680ad",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "RESET",
        "info": "",
        "x": 2490,
        "y": 100,
        "wires": []
    },
    {
        "id": "a0f16c5abc5d653d",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Wert Bypass",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_bypass",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "wertbypass",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 760,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "f76cb1b980c3bdf2",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "WertBypass",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_bypass"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 290,
        "y": 3180,
        "wires": [
            [
                "924fcf53aa0acbdc"
            ]
        ]
    },
    {
        "id": "924fcf53aa0acbdc",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Setze Flow-Variable WertBypass",
        "func": "let wrmax = flow.get (\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\"); \nflow.set(\"WertBypass\", Math.max(wrmin,Math.min(msg.payload,wrmax)));\nmsg.topic = \"WertBypass\";\nmsg.payload = flow.get(\"WertBypass\");\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 3180,
        "wires": [
            [
                "5a619949abdec684"
            ]
        ]
    },
    {
        "id": "ee29490c9c4b5005",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "e1165b70369f2b1d",
        "name": "Setze WR auf 100W Ausgang",
        "func": "let regelwert = 100; // in Watt\nlet wrmax = 400; //MAX- WR\nregelwert = (regelwert / wrmax * 100); // in %\nmsg.payload = regelwert;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 4000,
        "wires": [
            [
                "041e921ba09a57a6"
            ]
        ]
    },
    {
        "id": "041e921ba09a57a6",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "e1165b70369f2b1d",
        "name": "Setze Hoymiles WR",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "number.dtu_leistungsbegrenzung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload}}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "number",
        "service": "set_value",
        "x": 840,
        "y": 4000,
        "wires": [
            []
        ]
    },
    {
        "id": "3c960d972905ddd8",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "e1165b70369f2b1d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4000,
        "wires": [
            [
                "ee29490c9c4b5005"
            ]
        ]
    },
    {
        "id": "1f11ef02984634d4",
        "type": "http request",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Shelly 3EM Pro http",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.178.117/rpc/EM.GetStatus?id=0",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 780,
        "y": 2220,
        "wires": [
            [
                "66a15f5adc0815dc",
                "3f77c130efc4805a"
            ]
        ]
    },
    {
        "id": "e2258c6eea29d2b9",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "3c31d8008dcaffaa",
        "name": "Setze WR EZ1 Output",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": true,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "number.solar_maximale_leistung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 840,
        "y": 4100,
        "wires": [
            []
        ]
    },
    {
        "id": "e7e9befaa8453b4d",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3c31d8008dcaffaa",
        "name": "Setze WR auf 600W Ausgang",
        "func": "let regelwert = 600;\nmsg.payload = { einspeisewert: regelwert };\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 4100,
        "wires": [
            [
                "e2258c6eea29d2b9"
            ]
        ]
    },
    {
        "id": "0ec176a2fa37ecc0",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "3c31d8008dcaffaa",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4100,
        "wires": [
            [
                "e7e9befaa8453b4d"
            ]
        ]
    },
    {
        "id": "367af67087a908a8",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "Manuell AUS",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1950,
        "y": 2460,
        "wires": [
            [
                "8a4a05751fdc343f"
            ]
        ]
    },
    {
        "id": "3b9421d90a4b9fd3",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "Manuell EIN",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1950,
        "y": 2260,
        "wires": [
            [
                "05397794624406c5"
            ]
        ]
    },
    {
        "id": "9467d9f7df48e4e5",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "WR AN/AUS?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_wr_aus"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 120,
        "wires": [
            [
                "f5ac4859d53b8c34"
            ],
            []
        ]
    },
    {
        "id": "25c2c1d8b0140bb9",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Termin",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_terminmodus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "termin",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 770,
        "y": 800,
        "wires": [
            [
                "958b193833400787"
            ]
        ]
    },
    {
        "id": "2986171de753aadb",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WRTyp",
        "property": "WRTyp",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 2400,
        "y": 2260,
        "wires": [
            [
                "3f310be62393785c"
            ],
            [
                "d75f80acac58c46f"
            ],
            [
                "2901366668454020"
            ]
        ]
    },
    {
        "id": "113787982a56301f",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WRTyp",
        "property": "WRTyp",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 2400,
        "y": 2400,
        "wires": [
            [
                "4119817686335d91"
            ],
            [
                "88f0ebf6669abe2f"
            ],
            [
                "a3802b99388a73e1"
            ]
        ]
    },
    {
        "id": "d75f80acac58c46f",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "Hoymiles ein",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "button.press",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "button.wechselrichter_einschalten"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "button",
        "service": "press",
        "x": 2770,
        "y": 2320,
        "wires": [
            []
        ]
    },
    {
        "id": "88f0ebf6669abe2f",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "Hoymiles Aus",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "button.press",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "button.wechselrichter_ausschalten"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "button",
        "service": "press",
        "x": 2780,
        "y": 2480,
        "wires": [
            []
        ]
    },
    {
        "id": "722460ce5b6e1c2d",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "Einspeisgrenze neu setzen",
        "func": "//Welcher Termin ist der Aktive?\nlet ac = flow.get(\"AktiverTermin\"); // Date1 oder Date2 oder Date3\n\nconst wert1 = flow.get(\"Wert1\");\nconst wert2 = flow.get(\"Wert2\");\nconst wert3 = flow.get(\"Wert3\");\nlet wert = flow.get(\"MaxEinspeisung\");\n\n    switch (ac)\n    {\n    case \"Date1\":\n        {\n        wert = wert1;\n        break;\n        }\n    case \"Date2\":\n        {\n        wert = wert2;\n        break;\n        }\n    case \"Date3\":\n        {\n        wert = wert3\n        break;\n        }\n    }\nflow.set(\"MaxEinspeisung\", wert);\nmsg.payload = {einspeisewert: wert};\nnode.status(`Date=${ac}, Wert=${wert}`);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 3500,
        "wires": [
            [
                "ca349456294f5c38"
            ]
        ]
    },
    {
        "id": "df27770545d213b5",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "",
        "property": "WRTyp",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 750,
        "y": 1320,
        "wires": [
            [
                "df1e2cb0ac09ba12",
                "7d0404303c8fad6d",
                "b79ae4256daf27f6",
                "5c36c0c1bfabe8e7"
            ],
            [
                "df1e2cb0ac09ba12",
                "7d0404303c8fad6d",
                "5c36c0c1bfabe8e7",
                "b79ae4256daf27f6"
            ],
            [
                "bf65d001e486db67",
                "df1e2cb0ac09ba12",
                "f81801a182e992f9",
                "5c36c0c1bfabe8e7"
            ],
            [
                "f81801a182e992f9",
                "5c36c0c1bfabe8e7",
                "b2f2791b82ef1fd9"
            ],
            [
                "69c9aaf49d7fabba",
                "f81801a182e992f9"
            ]
        ]
    },
    {
        "id": "dd3a208eb767c579",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Regler Ausgang ermitteln",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_select.regler_ausgang",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "actor",
                "propertyType": "flow",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 430,
        "y": 1160,
        "wires": [
            [
                "039ee9a7ab711a33"
            ]
        ]
    },
    {
        "id": "80276a25567d0ce3",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0a94c4e6766e62c9",
        "name": "Set WR",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "number",
        "service": "set_value",
        "x": 1320,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "b2f2791b82ef1fd9",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "7d73a67d14204ea2",
        "name": "surfers Regelsystem OFF",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_boolean.turn_off",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_boolean.regler_aktiv"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_boolean",
        "service": "turn_off",
        "x": 430,
        "y": 1600,
        "wires": [
            [
                "68eb3e92f051ff26"
            ]
        ]
    },
    {
        "id": "df1e2cb0ac09ba12",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "surfers Regelsystem ON",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_boolean.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_boolean.regler_aktiv"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_boolean",
        "service": "turn_on",
        "x": 1130,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "7d0404303c8fad6d",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Setze Zendure Mode Off",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "select.select_option",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "select.zendure_manager_operation"
        ],
        "labelId": [],
        "data": "{\"option\":\"off\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "select",
        "service": "select_option",
        "x": 1130,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "44725bc13c3d9599",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "a0b4a6e2b0bd2354",
        "name": "Setze Zendure Manual",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "select.select_option",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "select.zendure_manager_operation"
        ],
        "labelId": [],
        "data": "{\"option\":\"manual\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "select",
        "service": "select_option",
        "x": 1300,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "b79ae4256daf27f6",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "5429a937f7d4fe2f",
        "name": "Set WR auf: 80W",
        "func": "//Typ1 oder Typ2 WR\n//die WR sollen initialisiert werden mit einer Vorgabe\n//Regelwert wird auf 80W gesetzt\n//die Regelung √ºbernimmt dann die Bildung des Regelwertes von diesem Ausgangswert\n\nflow.set(\"Regelwert\", 80); //80W\nlet wrmax = flow.get(\"WRLeistung\");\nlet leistung = flow.get(\"Regelwert\");\nlet wrhersteller = flow.get(\"WRHersteller\");\nlet zielSensor =  flow.get(\"wrSensor_typ1\");\n\nswitch (wrhersteller)\n    {\n    case \"ABS\":\n        zielSensor = flow.get(\"wrSensor_typ1\");\n        msg.payload = {\n        einspeisewert: leistung,\n        sensor: zielSensor};\n        // node.warn(leistung);\n        return msg;\n        \n    case \"REL\":\n        zielSensor = flow.get(\"wrSensor_typ2\");\n        leistung = Math.round((leistung / wrmax) * 100); //10% = 80W\n        msg.payload = {\n        einspeisewert: leistung,\n        sensor: zielSensor};\n        // node.warn(leistung);\n        return msg; \n    }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 1040,
        "wires": [
            [
                "e6c67233c1c5b911"
            ]
        ]
    },
    {
        "id": "bf65d001e486db67",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "a0b4a6e2b0bd2354",
        "name": "Set WRTyp 4: 80",
        "func": "flow.set(\"WRTyp\", 4);\nflow.set(\"Regelwert\", 80);\nlet zielSensor = flow.get(\"wrSensor_typ4\");\nlet wrmax = flow.get (\"Regelwert\");\n\nmsg.payload = {\n    einspeisewert: wrmax,\n    sensor: zielSensor\n};\n//msg.payload = {sensor: zielSensor};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 1660,
        "wires": [
            [
                "44725bc13c3d9599",
                "ec84cf4771cfbcac"
            ]
        ]
    },
    {
        "id": "51239912e3877c4d",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Regler Ausgang √ºbertragen",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.regler_ausgang"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "actor",
                "propertyType": "flow",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 400,
        "y": 1460,
        "wires": [
            [
                "039ee9a7ab711a33"
            ]
        ]
    },
    {
        "id": "039ee9a7ab711a33",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "WRTyp ermitteln",
        "func": "// Den empfangenen Typ aus der Nachricht holen\nlet typ = msg.payload;\n\n// Tabelle mit allen Typen und ihren zugeh√∂rigen Einstellungen\n// Jede Eigenschaft enth√§lt, was gesetzt werden soll\nconst typen = {\n   \"AUS\": { WRTyp: 0, payload: 0, Reglerkp: 1 },\n   \"EZ1\": { WRTyp: 1, payload: 1, Reglerkp: 1 },\n   \"HMS\": { WRTyp: 2, payload: 2, Reglerkp: 1 },\n// \"OUT\": { WRTyp: 3, payload: 3, Reglerkp: 1 },\n   \"MAN\": { WRTyp: 4, payload: 4, Reglerkp: 0.8 },\n   \"SMT\": { WRTyp: 5, payload: 5 }\n};\n\n// Pr√ºfen, ob der empfangene Typ in der Tabelle existiert\nif (typen[typ]) {\n   const einstellung = typen[typ];\n\n   // Den passenden Wechselrichter-Typ im Flow-Speicher ablegen\n   flow.set(\"WRTyp\", einstellung.WRTyp);\n\n   // Die neue Payload in der Nachricht speichern (wird an den n√§chsten Node weitergegeben)\n   msg.payload = einstellung.payload;\n\n   // Falls f√ºr diesen Typ ein Regler-Kp-Wert definiert ist, diesen ebenfalls speichern\n   if (einstellung.Reglerkp !== undefined) {\n      flow.set(\"Reglerkp\", einstellung.Reglerkp);\n   }\n} else {\n   // Optional: Wenn der Typ unbekannt ist, eine Warnung ausgeben\n   node.warn(\"Unbekannter Typ: \" + typ);\n}\n\n// Statusanzeige im Node aktualisieren (sichtbar im Flow)\nnode.status({ fill: \"green\", shape: \"ring\", text: \"WRTyp: \" + typ });\n\n// Nachricht zur√ºckgeben, damit der Flow weiterl√§uft\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1320,
        "wires": [
            [
                "df27770545d213b5"
            ]
        ]
    },
    {
        "id": "d9fb180bd5fd6ff8",
        "type": "link in",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "link in 11",
        "links": [
            "f5ac4859d53b8c34"
        ],
        "x": 235,
        "y": 1080,
        "wires": [
            [
                "dd3a208eb767c579",
                "e01d8fa50d01f508"
            ]
        ]
    },
    {
        "id": "db71458988a0ae4a",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Bypass?",
        "property": "Bypass",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 480,
        "y": 2080,
        "wires": [
            [
                "4f2a4b1d2bb4a50a"
            ],
            [
                "f539cfde4411e802"
            ]
        ]
    },
    {
        "id": "4f2a4b1d2bb4a50a",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Bypass-Handling",
        "func": "let debug = flow.get(\"Debug\");\nlet wrmax = flow.get (\"WRLeistung\"); //max. WR Leistung in W\nlet wertbypass = flow.get (\"WertBypass\"); //Begrenzung im Bypass\n//flow.set (\"MaxEinspeisung\", wertbypass);\nlet fehler;\nlet max = Math.min (wertbypass, wrmax);\n\n//letzte Einstellung des WR laden\nlet vorher = flow.get(\"Regelwert\");\nlet neu = vorher + 50;\nneu = Math.min( max, neu);\n//neu = wrmax;\nflow.set(\"Regelwert\", neu);\n//Wenn sich der Reglewert nicht g√§ndert hat: Ignore\nlet diff = neu - vorher; \n\nnode.status({\n  text: `Regelwert: ${neu}`\n});\n\nif (debug) {\nnode.warn ({max, diff, vorher, wertbypass, neu});\n}\n\nif (diff != 0)\n    {\n    msg.payload = {einspeisewert: neu};\n    return msg;\n    }\nreturn;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 2060,
        "wires": [
            [
                "68c44e68d8a62aa4"
            ]
        ]
    },
    {
        "id": "fc7613a47a09c1a6",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "WRTyp nicht AUS?",
        "property": "WRTyp",
        "propertyType": "flow",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1970,
        "y": 1940,
        "wires": [
            [
                "13971ddb6ad995e2"
            ],
            []
        ]
    },
    {
        "id": "68eb3e92f051ff26",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "7d73a67d14204ea2",
        "name": "Setze Zendure Smart",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "select.select_option",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "select.zendure_manager_operation"
        ],
        "labelId": [],
        "data": "{\"option\":\"smart\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "select",
        "service": "select_option",
        "x": 420,
        "y": 1660,
        "wires": [
            [
                "d36943bed8f6d1b6"
            ]
        ]
    },
    {
        "id": "e6c67233c1c5b911",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "5429a937f7d4fe2f",
        "name": "Setze WR ",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 1320,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "ec84cf4771cfbcac",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "a0b4a6e2b0bd2354",
        "name": "Set WR",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "number",
        "service": "set_value",
        "x": 1320,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "edcb9390f933d4b7",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "Initialisierung",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_button.regler_init"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 180,
        "wires": [
            [
                "f5ac4859d53b8c34"
            ]
        ]
    },
    {
        "id": "82e6e623f87b357b",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "PI-Regler",
        "func": "// PI-Regler\nlet debug = flow.get(\"Debug\");\nlet wrmax = flow.get(\"WRLeistung\");       // max. WR-Leistung in W\nlet wrmin = flow.get(\"WRminLeistung\");    // min. WR-Leistung in W\nlet soll = flow.get(\"Sollwert\");          // Sollwert in W\nlet grenze = flow.get(\"MaxEinspeisung\");  // max. Einspeisung in W\nlet hyst = global.get(\"Hysterese\");       // Hysteresebereich\n\n// Regler-Parameter\nlet Kp = 0.8;      // Proportionalanteil\nlet Ki = 0.1;      // Integralanteil (z.‚ÄØB. 0.1 f√ºr moderates Verhalten)\n\n// Hole bisherige Werte\nlet vorher = flow.get(\"Regelwert\") || 0;\nlet I_summe = Math.round(flow.get(\"I_summe\")) || 0;\n\n// Messwert Smartmeter\nlet leistung = Number(msg.payload.total_act_power);\nflow.set(\"3em\", leistung);\n\n// Fehlerberechnung\nlet fehler = Math.round(soll - leistung);\n\n// Optional: Hysterese einbauen (kein I-Update im Totband)\nif (Math.abs(fehler) < hyst) {\n    fehler = 0;\n}\nflow.set(\"fehler\", fehler);\n\n// Integriere den Fehler (I-Anteil)\nI_summe += fehler;\nflow.set(\"I_summe\", I_summe);\n\n// PI-Regelung: u = Kp * fehler + Ki * ‚àëfehler\nlet neu = Math.round(vorher - Kp * fehler - Ki * I_summe);\n\n// S√§ttigung\nneu = Math.max(wrmin, Math.min(wrmax, neu));\nneu = Math.min(neu, grenze);\n\n// Optional: Anti-Windup ‚Üí Wenn neu an Grenze, I-Anteil nicht weiter aufsummieren\nif (neu === wrmin || neu === wrmax || neu === grenze) {\n    I_summe -= fehler; // Fehler zur√ºcknehmen\n    flow.set(\"I_summe\", I_summe);\n}\n\nflow.set(\"Regelwert\", neu);\n\n// Pr√ºfe √Ñnderung\nlet diff = neu - vorher;\n\nif (debug) {\n    node.warn({ diff, vorher, fehler, I_summe, grenze, neu });\n}\n\nif (diff !== 0) {\n    msg.payload = { einspeisewert: neu };\n    return msg;\n}\n\nreturn;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 2220,
        "wires": [
            [
                "68c44e68d8a62aa4",
                "240b1ea3948dee0a"
            ]
        ]
    },
    {
        "id": "66a15f5adc0815dc",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "debug 14",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 980,
        "y": 2140,
        "wires": []
    },
    {
        "id": "be89d5ddb5c4de40",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "PID-Regler",
        "func": "let debug = flow.get(\"Debug\");\nlet wrmax = flow.get(\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\");\nlet soll = flow.get(\"Sollwert\");\nlet grenze = flow.get(\"MaxEinspeisung\");\nlet hyst = global.get(\"Hysterese\");\n\n// Reglerparameter\nlet Kp = 0.9;       // Proportional\nlet Ki = 0.1;       // Integral\nlet Kd = 0.3;       // Derivativ\nlet D_Filter = 0.2; // Gl√§ttungsfaktor (0.0 = stark gefiltert, 1.0 = roh)\n\n// Historische Werte\nlet vorher = flow.get(\"Regelwert\") || 0;\nlet I_summe = flow.get(\"I_summe\") || 0;\nlet letzterFehler = flow.get(\"letzterFehler\") || 0;\nlet letzterD = flow.get(\"letzterD\") || 0;\n\n// Aktueller Messwert\nlet leistung = Number(msg.payload.total_act_power);\nflow.set(\"3em\", leistung);\nlet fehler = Math.round(soll - leistung);\n\n// Hysteresezone beachten\nif (Math.abs(fehler) < hyst) {\n    fehler = 0;\n}\nflow.set(\"fehler\", fehler);\n\n// I-Anteil: Fehler aufsummieren\nI_summe += fehler;\nflow.set(\"I_summe\", I_summe);\n\n// D-Anteil: √Ñnderung des Fehlers berechnen\nlet dFehler = Math.round(fehler - letzterFehler);\nlet D_roh = Kd * dFehler;\n\n// Gl√§ttung (D-Filter, gegen Rauschen)\nlet D = D_Filter * D_roh + (1 - D_Filter) * letzterD;\nflow.set(\"letzterD\", D);\nflow.set(\"letzterFehler\", fehler);\n\n// PID-Regelung\nlet neu = Math.round(vorher - Kp * fehler - Ki * I_summe - D);\n\n// S√§ttigung\nneu = Math.max(wrmin, Math.min(wrmax, neu));\nneu = Math.min(neu, grenze);\n\n// Anti-Windup\nif (neu === wrmin || neu === wrmax || neu === grenze) {\n    I_summe -= Math.round(fehler);\n    flow.set(\"I_summe\", I_summe);\n}\n\nflow.set(\"Regelwert\", neu);\n\n// √Ñnderung pr√ºfen\nlet diff = neu - vorher;\n\nif (debug) {\n    node.warn({ diff, vorher, fehler, I_summe, D, neu });\n}\n\nif (diff !== 0) {\n    msg.payload = { einspeisewert: neu };\n    return msg;\n}\n\nreturn;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2260,
        "wires": [
            [
                "68c44e68d8a62aa4",
                "240b1ea3948dee0a"
            ]
        ]
    },
    {
        "id": "5a619949abdec684",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "035acd6f5889242d",
        "name": "Einspeisgrenze neu setzen",
        "func": "//Wenn AUS, dann stelle alten Wert wieder her.\nlet grenze = flow.get (\"WertBypass\"); //max.Einspeisung\nnode.status({ text: 'Einspeisegrenze: ' + grenze })\nmsg.payload = {einspeisewert: grenze};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 3180,
        "wires": [
            []
        ]
    },
    {
        "id": "f6b17c0a7515dc64",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "Debugzeile bauen",
        "func": "let debug = flow.get(\"Debug\");\nlet einspeisewert = flow.get (\"Plus1pm\");\nlet bypass = flow.get(\"Bypass\");\nlet wrtyp = flow.get(\"WRTyp\");\nlet wrher = flow.get (\"WRHersteller\")\nlet wrmax = flow.get(\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\");\nlet regler_aktiv = flow.get(\"ReglerAktiv\");\nlet termin_on = flow.get(\"Terminmodus\");\nlet max_einspeisung = flow.get(\"MaxEinspeisung\");\nlet regelwert = flow.get(\"Regelwert\");\nlet drei_em = flow.get (\"3em\");\nlet soll = flow.get(\"Sollwert\");\nlet wr_aktiv = global.get ( \"WRAktiv\");\nlet fehler = flow.get (\"fehler\");\nlet repeat = flow.get (\"WRRepeat\");\n//let isostring = new Date().toISOString();\n//let timestamp = new Date(isostring);\nlet timestamp = new Date().toLocaleString(\"de-DE\");\n\n// --- Erkennen, ob Fehler oder Status ---\nlet isError = msg.error !== undefined;\n\n// --- Felder f√ºr CSV ---\nlet logType = isError ? \"Error\" : \"DEBUG\";\nlet nodeName = isError ? (msg.error?.source?.name || \"unknown\") : \"DEBUG\";\nlet nodeId = isError ? (msg.error?.source?.id || \"\") : \"\";\nlet nodeType = isError ? (msg.error?.source?.type || \"\") : \"\";\nlet message = isError ? (msg.error?.message || \"Unbekannter Fehler\") : \"DEBUG\";\n\n// --- CSV-Zeile zusammenbauen ---\nmsg.payload =\n    `${timestamp};${logType};${nodeName};${nodeId};${nodeType};` +\n    `Bypass=${bypass}; WRAusgang=${wrtyp}; WRArt=${wrher}; WRMax=${wrmax}; WRMin=${wrmin};` +\n    `WRAktiv=${wr_aktiv};ReglerAktiv=${regler_aktiv};TerminMod=${termin_on};MaxEinspeisung=${max_einspeisung};` +\n    `Sollwert=${soll};Fehler=${fehler};Regelwert=${regelwert};Einspeisewert=${einspeisewert};Smartmeter=${drei_em};WRRepeat=${repeat};${message}\\n`;\n\n// --- Status im Editor anzeigen ---\nnode.status({ text: `${logType} Log geschrieben` });\nsetTimeout(() => node.status({}), 3000);\n\nif (debug){\n//    msg.payload = `${timestamp}, Bypass=${bypass}, WRTyp=${wrtyp}, WRHersteller=${wrher}; WRMax=${wrmax}, WRMin=${wrmin}, WRAktiv=${wr_aktiv} , ReglerAktiv=${regler_aktiv}, Termin=${termin_on}, MaxEinspeisung=${max_einspeisung}, Sollwert=${soll}, Fehler=${fehler}, Regelwert=${regelwert}, Einspeisewert=${einspeisewert}, Smartmeter=${drei_em}, WRRepeat=${repeat}`;\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 2000,
        "wires": [
            [
                "78dbc119241bb5d0"
            ]
        ]
    },
    {
        "id": "78dbc119241bb5d0",
        "type": "file",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "In Datei schreiben",
        "filename": "/config/debug-log1.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1190,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "7e065cdfb6cd92bd",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "if Debug?",
        "func": "if (flow.get(\"Debug\") === true) {\n    return [msg, null]; // an Ausgang eins senden\n    }\nelse {\n    return; // nichts senden\n    }",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 2000,
        "wires": [
            [
                "f6b17c0a7515dc64"
            ],
            []
        ]
    },
    {
        "id": "2901366668454020",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "ABS or REL",
        "property": "WRHersteller",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "ABS",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "REL",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 2510,
        "y": 2320,
        "wires": [
            [
                "3f310be62393785c"
            ],
            [
                "d75f80acac58c46f"
            ]
        ]
    },
    {
        "id": "a3802b99388a73e1",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "ABS or REL",
        "property": "WRHersteller",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "ABS",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "REL",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 2510,
        "y": 2460,
        "wires": [
            [
                "4119817686335d91"
            ],
            [
                "88f0ebf6669abe2f"
            ]
        ]
    },
    {
        "id": "f81801a182e992f9",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "4cb2b580c2b15ca9",
        "name": "",
        "property": "WRHersteller",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "ABS",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "REL",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1010,
        "y": 1460,
        "wires": [
            [
                "bd67f151a7c8bdbe"
            ],
            [
                "9e26b0c7a7787d25"
            ]
        ]
    },
    {
        "id": "ae2d81258bd8fae4",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "4cb2b580c2b15ca9",
        "name": "Setze WR",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 1320,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "1a09bce668c12667",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "typ",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_select.regler_typ",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "typ",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 340,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "3f77c130efc4805a",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "",
        "property": "ReglerTyp",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "P",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "PI",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "PID",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 970,
        "y": 2220,
        "wires": [
            [
                "3"
            ],
            [
                "82e6e623f87b357b"
            ],
            [
                "be89d5ddb5c4de40"
            ]
        ]
    },
    {
        "id": "91570a4c78376cef",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "0245b5a6cd994e5a",
        "name": "Setze WR auf 600W Ausgang",
        "func": "let regelwert = 600;\n\nlet zielSensor = \"number.solar_maximale_leistung\";\n\nmsg.payload = {\n    einspeisewert: regelwert,\n    sensor: zielSensor\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 4200,
        "wires": [
            [
                "e25dd8e781b3f57d"
            ]
        ]
    },
    {
        "id": "1c1b6369a59eabbe",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "0245b5a6cd994e5a",
        "name": "timestamp",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4200,
        "wires": [
            [
                "91570a4c78376cef"
            ]
        ]
    },
    {
        "id": "e25dd8e781b3f57d",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0245b5a6cd994e5a",
        "name": "Setze WR EZ1 Output (dynamisch)",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": {{ payload.einspeisewert }}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "{{ payload.sensor }}"
        },
        "x": 860,
        "y": 4200,
        "wires": [
            []
        ]
    },
    {
        "id": "fc9dbf8b3b334185",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "d6568f655d82ddea",
        "name": "Hole Sensor",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "einspeiseSensor",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 590,
        "y": 4300,
        "wires": [
            [
                "e452733f940cf159"
            ]
        ]
    },
    {
        "id": "e452733f940cf159",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "d6568f655d82ddea",
        "name": "Ausgabe",
        "func": "let power = Number(msg.payload[0].state);\n\nnode.warn (power);\n\nif (power > 2) {\n    node.warn (\">2\")\n    return [msg , null];\n    }\nelse {\n    node.warn (\"<2\")\n    return [null ,msg];\n    }\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 4300,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "bb929c7f2e0a7c3f",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "d6568f655d82ddea",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4300,
        "wires": [
            [
                "fc9dbf8b3b334185"
            ]
        ]
    },
    {
        "id": "bd67f151a7c8bdbe",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cb2b580c2b15ca9",
        "name": "Set WR Typ 1: Max",
        "func": "let zielSensor = flow.get(\"wrSensor_typ1\");\nlet wrmax = flow.get (\"WRLeistung\");\n\nmsg.payload = {\n    einspeisewert: wrmax,\n    sensor: zielSensor\n};\n//msg.payload = {sensor: zielSensor};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 1400,
        "wires": [
            [
                "ae2d81258bd8fae4"
            ]
        ]
    },
    {
        "id": "9e26b0c7a7787d25",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cb2b580c2b15ca9",
        "name": "Set WR Typ 2: Max",
        "func": "let zielSensor = flow.get(\"wrSensor_typ2\");\nlet wrmax = 100;\n\nmsg.payload = {\n    einspeisewert: wrmax,\n    sensor: zielSensor\n};\n//msg.payload = {sensor: zielSensor};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 1520,
        "wires": [
            [
                "ae2d81258bd8fae4"
            ]
        ]
    },
    {
        "id": "5c36c0c1bfabe8e7",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "0a94c4e6766e62c9",
        "name": "Set WR Typ 3: Max",
        "func": "// Wenn ty1 oder typ2 oder typ4 oder 5 dann Solarflow Outputlimit setzen auf MAX\n\nlet zielSensor = flow.get(\"wrSensor_typ3\");\nlet sflimit = flow.get (\"SFMax\");\n\nmsg.payload = { \n    einspeisewert: sflimit,\n    sensor: zielSensor \n    };\n//msg.payload = {sensor: zielSensor};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 1300,
        "wires": [
            [
                "80276a25567d0ce3"
            ]
        ]
    },
    {
        "id": "7f5bc6e47b11df44",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "Setze Ausgang WR Regelung",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 2570,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "b78e47bc659c68e6",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "70cc64c2bba0fbd9",
        "name": "HIER: WR DeviceTracker pr√ºfen",
        "info": "",
        "x": 1810,
        "y": 460,
        "wires": []
    },
    {
        "id": "0d452cdc92314b7d",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "Wenn Sensornamen in 1.1. gut gepflegt, dann l√§uft die Routine generisch",
        "info": "",
        "x": 2380,
        "y": 1940,
        "wires": []
    },
    {
        "id": "2c22eb5a28b88af3",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "d8febfbf64f9a1dc",
        "name": "Hole Daten",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "einspeiseSensor",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 350,
        "y": 2200,
        "wires": [
            [
                "76f6c97f59e020a9"
            ]
        ]
    },
    {
        "id": "76f6c97f59e020a9",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "d8febfbf64f9a1dc",
        "name": "Sensor-ID aus Flow",
        "func": "let power = Number(msg.payload[0].state);\nflow.set(\"Plus1pm\", power);\n//node.warn (power);\nnode.status({ text: 'Einspeisung: ' + power });\n\nif (power > 2) {\n    return [msg , null];\n    }\nelse {\n    return [null ,msg];\n    }\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 2260,
        "wires": [
            [
                "1f11ef02984634d4"
            ],
            []
        ]
    },
    {
        "id": "6bd08e9d0b68c8e0",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "da59e0c300a23601",
        "name": "Setz URL",
        "func": "flow.set (\"Smartmeter\", \"http://192.168.178.117/rpc/EM.GetStatus?id=0\")\nmsg.url = flow.get (\"Smartmeter\");\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 4420,
        "wires": [
            [
                "3c8cabaa304bd745"
            ]
        ]
    },
    {
        "id": "3c8cabaa304bd745",
        "type": "http request",
        "z": "479e3443afedb613",
        "g": "da59e0c300a23601",
        "name": "Shelly 3EM Pro http",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 680,
        "y": 4420,
        "wires": [
            [
                "2940a6546713a79a"
            ]
        ]
    },
    {
        "id": "2940a6546713a79a",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "da59e0c300a23601",
        "name": "",
        "func": "let leistung = Number(msg.payload.total_act_power);\n\nnode.warn (leistung);\nnode.status({fill:\"green\",shape:\"ring\",text:\"Leistung: \" +leistung});\n\nreturn",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 4420,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "a056e94e32dc397e",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "da59e0c300a23601",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4420,
        "wires": [
            [
                "6bd08e9d0b68c8e0"
            ]
        ]
    },
    {
        "id": "d36943bed8f6d1b6",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "7d73a67d14204ea2",
        "name": "Regler WR An",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_boolean.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_boolean.regler_wr_aus"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_boolean",
        "service": "turn_on",
        "x": 400,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "0a3fd6bcfaa113dc",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "02ed511c2d909f2f",
        "name": "Setze WR auf 100W Ausgang",
        "func": "let regelwert = 100;\nlet wrmax = 400; //MAX- WR\n\nregelwert = regelwert/wrmax * 100;\n\nlet zielSensor = \"number.dtu_leistungsbegrenzung\";\n\nmsg.payload = {\n    einspeisewert: regelwert,\n    sensor: zielSensor\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 4520,
        "wires": [
            [
                "ac712f39db9196a3"
            ]
        ]
    },
    {
        "id": "8670dc77189b5b5f",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "02ed511c2d909f2f",
        "name": "timestamp",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4520,
        "wires": [
            [
                "0a3fd6bcfaa113dc"
            ]
        ]
    },
    {
        "id": "ac712f39db9196a3",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "02ed511c2d909f2f",
        "name": "Setze WR HMS Output (dynamisch)",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": {{ payload.einspeisewert }}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "{{ payload.sensor }}"
        },
        "x": 870,
        "y": 4520,
        "wires": [
            []
        ]
    },
    {
        "id": "9bcffdcf2913b47b",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Minimal Einspeisung",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_number.regler_minimale_einspeisung"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 310,
        "y": 2800,
        "wires": [
            [
                "15951ffac0a8ed47"
            ]
        ]
    },
    {
        "id": "15951ffac0a8ed47",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Setze Flow-Variable MinimalEinspeisung",
        "func": "let minimal = Number(msg.payload);\nflow.set(\"MinEinspeisung\", minimal);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 2800,
        "wires": [
            []
        ]
    },
    {
        "id": "b4b07729dd9d31ee",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "minimal",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_number.regler_minimale_einspeisung",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "minimal",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 800,
        "y": 380,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "30471465b9e6510f",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "APSystem home?",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "device_tracker.apsystems_2"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1730,
        "y": 2300,
        "wires": [
            [
                "36f3252fb4621270"
            ],
            []
        ]
    },
    {
        "id": "36f3252fb4621270",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "WR AN/AUS?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_wr_aus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1940,
        "y": 2320,
        "wires": [
            [
                "05397794624406c5"
            ],
            [
                "8a4a05751fdc343f"
            ]
        ]
    },
    {
        "id": "69c9aaf49d7fabba",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "cf998755e26fe945",
        "name": "Set SF out 100",
        "func": "// Wenn ty1 oder typ2 oder typ4 dann Solarflow Outputlimit setzen auf MAX\n\nlet zielSensor = flow.get(\"wrSensor_typ3\");\nlet sflimit = 100;\n\nmsg.payload = { \n    einspeisewert: sflimit,\n    sensor: zielSensor \n    };\n//msg.payload = {sensor: zielSensor};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1600,
        "wires": [
            [
                "f14903b8d8cafcf6"
            ]
        ]
    },
    {
        "id": "f14903b8d8cafcf6",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "cf998755e26fe945",
        "name": "Set WR",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.einspeisewert }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "number",
        "service": "set_value",
        "x": 700,
        "y": 1640,
        "wires": [
            [
                "ea244f2be20330ad"
            ]
        ]
    },
    {
        "id": "9c35e52d51caca37",
        "type": "delay",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3210,
        "y": 2200,
        "wires": [
            [
                "2986171de753aadb"
            ]
        ]
    },
    {
        "id": "ea244f2be20330ad",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "cf998755e26fe945",
        "name": "surfers Regelsystem OFF",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_boolean.turn_off",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_boolean.regler_aktiv"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_boolean",
        "service": "turn_off",
        "x": 750,
        "y": 1680,
        "wires": [
            [
                "9d7ca67058014a92"
            ]
        ]
    },
    {
        "id": "f95d4fe5b1ba92c3",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "HIER: kP Regler Verst√§rkung anpassen",
        "info": "",
        "x": 530,
        "y": 1260,
        "wires": []
    },
    {
        "id": "e01d8fa50d01f508",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Hole Daten SFMax",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "wrSensor_typ3",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 410,
        "y": 1080,
        "wires": [
            [
                "2945df02bcac2061"
            ]
        ]
    },
    {
        "id": "2945df02bcac2061",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": "Set SFMax",
        "func": "let sfmax = Number(msg.payload[0].state);\nflow.set(\"SFMax\", sfmax);\nreturn;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "f64a874c50bdf191",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "connected",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.solarherwegh_connection_status",
        "state_type": "num",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "connected",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 810,
        "y": 420,
        "wires": [
            [
                "180ce22f05ebcd8b"
            ]
        ]
    },
    {
        "id": "b2900737df35050a",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Regler Typ",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.regler_typ"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "ReglerTyp",
                "propertyType": "flow",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 980,
        "y": 2720,
        "wires": [
            []
        ]
    },
    {
        "id": "31aef1593af4b0d7",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "SFMax",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "number.solarherwegh_output_limit"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "SFMax",
                "propertyType": "flow",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 970,
        "y": 2760,
        "wires": [
            []
        ]
    },
    {
        "id": "5e173fb39bf8170d",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "ConnectionStatus",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "sensor.solarherwegh_connection_status"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "Connected",
                "propertyType": "flow",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 1010,
        "y": 2800,
        "wires": [
            []
        ]
    },
    {
        "id": "8546724667636606",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "Hub ist Online WLAN",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "device_tracker.solarhub"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 1780,
        "y": 140,
        "wires": [
            [
                "1bdd52ee74cd6023"
            ],
            [
                "7a5d3ef92442a929"
            ]
        ]
    },
    {
        "id": "1bdd52ee74cd6023",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "aktiv",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_aktiv",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "aktiv",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2150,
        "y": 140,
        "wires": [
            [
                "8556d367c4b1fac5"
            ],
            [
                "7a5d3ef92442a929"
            ]
        ]
    },
    {
        "id": "f6d4dc83056b836e",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "HIER: WR DeviceTracker pr√ºfen",
        "info": "",
        "x": 1810,
        "y": 100,
        "wires": []
    },
    {
        "id": "959c8c911e7fde10",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Sonnaufgang +45",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "sensor.sun_next_rising"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "45",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1770,
        "y": 940,
        "wires": [
            [
                "10a5947e7b0e4bba"
            ]
        ]
    },
    {
        "id": "10a5947e7b0e4bba",
        "type": "change",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Monat",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$moment().month() + 1",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1990,
        "y": 940,
        "wires": [
            [
                "fd9ffa19de35ef1b"
            ]
        ]
    },
    {
        "id": "ee79553e2bee0ac5",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Manuell",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1750,
        "y": 1000,
        "wires": [
            [
                "10a5947e7b0e4bba"
            ]
        ]
    },
    {
        "id": "fd9ffa19de35ef1b",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Set Values",
        "func": "// Monat aus der Nachricht lesen\nlet monat = msg.payload;\n\n// Standardwerte definieren (falls Monat ung√ºltig)\nlet akku_min = flow.get (\"AbsoluteMinVol\");\nlet sollwert = 0;\nlet maxeinspeisung = 400;\n\n// Sensorname aus dem Flow-Speicher holen\nlet socsensor = flow.get(\"zHAMinSoCSensor\");\n\n// Konfigurationstabelle f√ºr jeden Monat\n// Format: Monat: { Akku_min, Sollwert, MaxEinspeisung }\nlet config = flow.get(\"ConfigValues\");\n\n// Wenn der Monat g√ºltig ist, Werte √ºbernehmen\nif (config[monat]) {\n    ({ akku_min, sollwert, maxeinspeisung } = config[monat]);\n} else {\n    node.warn(`Ung√ºltiger Monat: ${monat} ‚Äî Standardwerte werden verwendet`);\n}\n\n// Werte im Flow speichern\n// flow.set(\"Akku_min\", akku_min);\nflow.set(\"Sollwert\", sollwert);\nflow.set(\"MaxEinspeisung\", maxeinspeisung);\nflow.set (\"MaxEinspeisungSave\", maxeinspeisung);\n\n// Node-Status anzeigen\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `Monat: ${monat} | Akku_Min: ${akku_min} | Soll: ${sollwert} | Max: ${maxeinspeisung}`\n});\n\n// Drei Nachrichten f√ºr die Ausg√§nge erstellen\nlet msg1 = { payload: { value: akku_min, sensor: socsensor } };\nlet msg2 = { payload: sollwert };\nlet msg3 = { payload: maxeinspeisung };\n\n// Drei Ausg√§nge zur√ºckgeben\nreturn [msg1, msg2, msg3];\n",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 940,
        "wires": [
            [
                "40cd311eb34f8bec"
            ],
            [
                "3a896cce6e31964b"
            ],
            [
                "98eedc884b02a91c"
            ]
        ]
    },
    {
        "id": "c4baeda9f9677e08",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "4e7901031e717127",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2020,
        "y": 100,
        "wires": [
            [
                "1bdd52ee74cd6023"
            ]
        ]
    },
    {
        "id": "40cd311eb34f8bec",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Setze MinVol",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.value }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 2490,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "9d7ca67058014a92",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "cf998755e26fe945",
        "name": "Setze Zendure Off",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "select.select_option",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "select.zendure_manager_operation"
        ],
        "labelId": [],
        "data": "{\"option\":\"off\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "select",
        "service": "select_option",
        "x": 730,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "fa35dabff235479a",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Notify",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "notify.persistent_notification",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"message\":\"im Log nachschauen\",\"title\":\"WR Problem\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "notify",
        "service": "persistent_notification",
        "x": 3190,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "4bb62780a37020ed",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "4cd6e76302eb583f",
        "name": "Regelung aktiv?",
        "property": "ReglerAktiv",
        "propertyType": "flow",
        "rules": [
            {
                "t": "regex",
                "v": "^\\s*on\\s*$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1200,
        "y": 2640,
        "wires": [
            [],
            [
                "1b49fc372d8175f7"
            ]
        ]
    },
    {
        "id": "2d86efd2574df8ec",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "Regelung aktiv?",
        "property": "ReglerAktiv",
        "propertyType": "flow",
        "rules": [
            {
                "t": "regex",
                "v": "^\\s*on\\s*$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1180,
        "y": 3100,
        "wires": [
            [],
            [
                "f9c28e57357fbedd"
            ]
        ]
    },
    {
        "id": "d77905c6e4e680d6",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "4a0e658896e45770",
        "name": "Regelung aktiv?",
        "property": "ReglerAktiv",
        "propertyType": "flow",
        "rules": [
            {
                "t": "regex",
                "v": "^\\s*on\\s*$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1180,
        "y": 3560,
        "wires": [
            [],
            [
                "9c1f091862872c3f"
            ]
        ]
    },
    {
        "id": "3c38f71e3abb6567",
        "type": "http request",
        "z": "479e3443afedb613",
        "g": "46ac14d1f3bb7a07",
        "name": "Shelly 3EM Pro http",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.178.117/rpc/EM.GetStatus?id=0",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 520,
        "y": 4620,
        "wires": [
            [
                "bdf7929968ea7a52"
            ]
        ]
    },
    {
        "id": "5a942abc7cd65d2e",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "46ac14d1f3bb7a07",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4620,
        "wires": [
            [
                "3c38f71e3abb6567"
            ]
        ]
    },
    {
        "id": "bdf7929968ea7a52",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "46ac14d1f3bb7a07",
        "name": "Auswerten",
        "func": "//Hole aktuellen Verbrauchswert vom Shelly3EM RPC Abfrage\nlet leistung = Number(msg.payload.total_act_power);\nmsg.payload = leistung\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 4620,
        "wires": [
            [
                "5439dc35407ecda1"
            ]
        ]
    },
    {
        "id": "5439dc35407ecda1",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "46ac14d1f3bb7a07",
        "name": "debug 28",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 4620,
        "wires": []
    },
    {
        "id": "3a896cce6e31964b",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Set Sollwert",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_sollwert"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 2490,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "98eedc884b02a91c",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "72932590259c2eb2",
        "name": "Set Einspeisung",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_maximale_einspeisung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 2500,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "a63607adfff3fead",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "INIT vom Dashboard",
        "info": "1",
        "x": 390,
        "y": 200,
        "wires": []
    },
    {
        "id": "2f8099592faddc79",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "0ded3f6e0d781a4e",
        "name": " Dashboard-Wahl",
        "info": "",
        "x": 380,
        "y": 1380,
        "wires": []
    },
    {
        "id": "d8aad289353f949c",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "313a12776bf9f44c",
        "name": "Sonnenuntergang",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "sensor.sun_next_setting"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "num",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 1770,
        "y": 1320,
        "wires": [
            [
                "f5fa4b9134667e5d"
            ]
        ]
    },
    {
        "id": "bb94db99200bab27",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "313a12776bf9f44c",
        "name": "Calculate SOLL",
        "func": "let level = Number(msg.payload[0].state);\nlet capacity = global.get (\"Capacity\");\nlet soll;\n\n// In Abh√§ngigkeit von AKkukapazit√§t soll SOLL Level gesetzt werden\n// Im Winter wird meist Akku abgebaut...dann mehr Nullbezug\nif (capacity > 2000) {\n    soll = level > 85 ? -5 : level > 70 ? 0 : 10}\nelse {\n    soll = level > 85 ? 5 : level > 70 ? 10 : 10\n}\n\nmsg.payload = { soll };\nnode.status({ fill: \"green\", shape: \"ring\", text: \"SoC: \" + level });\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2260,
        "y": 1280,
        "wires": [
            [
                "f251eebcf0f8ca69"
            ]
        ]
    },
    {
        "id": "1cfab2d550d339ae",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "313a12776bf9f44c",
        "name": "Check 18:30",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 18 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1780,
        "y": 1260,
        "wires": [
            [
                "f5fa4b9134667e5d"
            ]
        ]
    },
    {
        "id": "f251eebcf0f8ca69",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "313a12776bf9f44c",
        "name": "Set Sollwert",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_sollwert"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.soll }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 2510,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "7893c8dbb115ef93",
        "type": "delay",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3210,
        "y": 2340,
        "wires": [
            [
                "113787982a56301f"
            ]
        ]
    },
    {
        "id": "e3472deef8161dec",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "b759be1778ad269d",
        "name": "EZ1 available?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "unavailable",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "switch.solar_wechselrichterstatus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 560,
        "y": 4760,
        "wires": [
            [
                "2dc24ace9b912ba2"
            ],
            [
                "6b62e9f5107a01db"
            ]
        ]
    },
    {
        "id": "2f8986cbd151a9ec",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "b759be1778ad269d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 4760,
        "wires": [
            [
                "e3472deef8161dec"
            ]
        ]
    },
    {
        "id": "6b62e9f5107a01db",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "b759be1778ad269d",
        "name": "debug 24",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 4780,
        "wires": []
    },
    {
        "id": "2dc24ace9b912ba2",
        "type": "debug",
        "z": "479e3443afedb613",
        "g": "b759be1778ad269d",
        "name": "debug 29",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 4720,
        "wires": []
    },
    {
        "id": "02ecee97db19ba57",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "EZ1 available?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "unavailable",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "switch.solar_wechselrichterstatus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2980,
        "y": 2400,
        "wires": [
            [
                "7893c8dbb115ef93"
            ],
            []
        ]
    },
    {
        "id": "318c162604820738",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "b6cbd1ee551c690b",
        "name": "EZ1 available?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "unavailable",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "switch.solar_wechselrichterstatus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2980,
        "y": 2260,
        "wires": [
            [
                "9c35e52d51caca37"
            ],
            []
        ]
    },
    {
        "id": "19c87395473efe5b",
        "type": "file",
        "z": "479e3443afedb613",
        "g": "33fc19028d8c92bf",
        "name": "In Datei schreiben",
        "filename": "/config/debug-log1.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 830,
        "y": 1900,
        "wires": [
            []
        ]
    },
    {
        "id": "63174e4704cb40ac",
        "type": "link in",
        "z": "479e3443afedb613",
        "g": "33fc19028d8c92bf",
        "name": "link in 17",
        "links": [
            "f5ac4859d53b8c34"
        ],
        "x": 365,
        "y": 1840,
        "wires": [
            [
                "1f6df3bd52dc3303"
            ]
        ]
    },
    {
        "id": "01c5ad8c136ab28c",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "33fc19028d8c92bf",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "15",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 1900,
        "wires": [
            [
                "1f6df3bd52dc3303"
            ]
        ]
    },
    {
        "id": "141f0ec3aa515c27",
        "type": "server-events",
        "z": "479e3443afedb613",
        "g": "fdb0ce097a97065d",
        "name": "",
        "server": "285afb99.5208c4",
        "version": 3,
        "exposeAsEntityConfig": "",
        "eventType": "homeassistant_started",
        "eventData": "",
        "waitForRunning": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event_type",
                "valueType": "jsonata"
            }
        ],
        "x": 360,
        "y": 60,
        "wires": [
            [
                "f5ac4859d53b8c34"
            ]
        ]
    },
    {
        "id": "7b996172714a688c",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "SetzeMaxEinspeisung",
        "func": "let level = msg.payload.ele;\nlet min = msg.payload.min;\nlet msg1;\n\nlet maxeinspeisung =150;\n\nlet grenze = flow.get(\"MaxEinspeisung\"); \n//node.warn(level);\n//node.warn(min);\n\n// Wenn nach Sonnenuntergang der SocLevel nur noch 10% weg ist vom eingestellten minimalen Ladezustand,\n// dann wird die Einspeisung auf den Wert maxeinspeisung begrenzt\n// damit wird die Last reduziert und ein kleiner Spannungsabfall erreicht\n// Routine kann gel√∂scht werden oder der Inject-Node kann deaktiviert werden.\n\nif (level < (min + 10)) {\n    msg1 = { payload: maxeinspeisung }; \n    flow.set (\"MaxEinspeisungSave\", grenze);\n    node.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `Level: ${level} | < | SocMin: ${min} + 10 `})\n    return [msg1, null];\n} else {\n    node.status({\n    fill: \"yellow\",\n    shape: \"dot\",\n    text: `Level: ${level} | > | SocMin: ${min} + 10 `})\n    return [null, null];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2660,
        "y": 1500,
        "wires": [
            [
                "1fdeb8e2804338d9"
            ],
            []
        ]
    },
    {
        "id": "1fdeb8e2804338d9",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "SetEinspeisung",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_maximale_einspeisung"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 2760,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "9d729c1d1740d366",
        "type": "join",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 2490,
        "y": 1500,
        "wires": [
            [
                "7b996172714a688c"
            ]
        ]
    },
    {
        "id": "3c0eb024a9b6d28a",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "16:00 bis 00:00 (30Min)",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "*/20 16-23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1810,
        "y": 1480,
        "wires": [
            [
                "15c60a8cea285214"
            ]
        ]
    },
    {
        "id": "15c60a8cea285214",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "nach sunrise",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sun.sun",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2030,
        "y": 1480,
        "wires": [
            [
                "f27d62e96ecd8f9c",
                "1327d2c0642ca6cc"
            ],
            []
        ]
    },
    {
        "id": "b9477af5c2654795",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "acff453100dcbbc9",
        "name": "Hole ElectricLevel",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "electricLevel",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 810,
        "y": 860,
        "wires": [
            [
                "2717c849e2440723"
            ]
        ]
    },
    {
        "id": "f5fa4b9134667e5d",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "313a12776bf9f44c",
        "name": "Hole ElectricLevel",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "electricLevel",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 2030,
        "y": 1280,
        "wires": [
            [
                "bb94db99200bab27"
            ]
        ]
    },
    {
        "id": "f27d62e96ecd8f9c",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "El.Level",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "electricLevel",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 2200,
        "y": 1440,
        "wires": [
            [
                "f7f1469c0b78556d"
            ]
        ]
    },
    {
        "id": "f7f1469c0b78556d",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "Soc Level",
        "func": "let level = Number(msg.payload[0].state);\nmsg.topic = \"ele\";\nmsg.payload = level;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Soc: \" +level});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2360,
        "y": 1440,
        "wires": [
            [
                "9d729c1d1740d366"
            ]
        ]
    },
    {
        "id": "e962ca54b4872db1",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "3d36f3e8b8cb3fe0",
        "name": "El.Level",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "electricLevel",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 360,
        "y": 3660,
        "wires": [
            [
                "c74815a7ace7eac8"
            ]
        ]
    },
    {
        "id": "c74815a7ace7eac8",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3d36f3e8b8cb3fe0",
        "name": "Setze Flow-Variable Bypass",
        "func": "// Variable aus Flow oder globalem Speicher\nlet level = Number(msg.payload[0].state);\n    if (level < 100) \n    {\n    node.status({fill:\"green\",shape:\"ring\",text:\"SoC \" +level});\n    flow.set(\"Bypass\", 0); //1 An; 0: Aus   \n    return; //nichts senden \n    }\n    else \n    {\n    node.status({ fill: \"red\", shape: \"ring\", text: \"SoC \" + level });\n    //flow.set(\"Regelwert\", 0); // Wenn Akku voll WR zun√§chst runterregeln\n    flow.set(\"Bypass\", 1); //1 An; 0: Aus    \n    return [null, msg]; // nur an Ausgang zwei senden\n    }",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 3660,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "c64e656e48de4e43",
        "type": "server-state-changed",
        "z": "479e3443afedb613",
        "g": "d0a61549998e4f87",
        "name": "Reglungsalgorithmus On/Off",
        "server": "285afb99.5208c4",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_boolean.regler_aktiv"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 340,
        "y": 2400,
        "wires": [
            [
                "512302055eac88b8"
            ],
            [
                "118030ec66a767e8"
            ]
        ]
    },
    {
        "id": "118030ec66a767e8",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "d0a61549998e4f87",
        "name": "Setze Grenze",
        "func": "// Regleung wurde ausgeschaltet\n// Fixeinspeisung wird gesetzt\nlet grenze = flow.get (\"MaxEinspeisung\"); //max.Einspeisung\n// flow.set (\"MaxEinspeisungSave\", grenze);\nflow.set (\"Regelwert\", grenze);\nnode.status({ text: 'Grenze: ' + grenze });\nmsg.payload = {einspeisewert: grenze};\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 2420,
        "wires": [
            [
                "e646756010d9f10c"
            ]
        ]
    },
    {
        "id": "e646756010d9f10c",
        "type": "link out",
        "z": "479e3443afedb613",
        "g": "d0a61549998e4f87",
        "name": "link out 12",
        "mode": "link",
        "links": [
            "60df30044c929c46"
        ],
        "x": 1405,
        "y": 2420,
        "wires": []
    },
    {
        "id": "512302055eac88b8",
        "type": "function",
        "z": "479e3443afedb613",
        "d": true,
        "g": "d0a61549998e4f87",
        "name": "Setze Grenze",
        "func": "let grenze = flow.get (\"MaxEinspeisungSave\")\n//flow.set (\"MaxEinspeisung\", grenze);\nnode.status({ text: 'Grenze: ' + grenze });\nmsg.payload = {einspeisewert: grenze};\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 2380,
        "wires": [
            []
        ]
    },
    {
        "id": "7c51c28aa24b93a7",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "caf11d3b06226cb7",
        "name": "Reset 08:00",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1770,
        "y": 1120,
        "wires": [
            [
                "e3ec4bb870c8a50a"
            ]
        ]
    },
    {
        "id": "e3ec4bb870c8a50a",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "caf11d3b06226cb7",
        "name": "Reset Inkrement",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "input_number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "input_number.regler_inkrement"
        ],
        "labelId": [],
        "data": "{\"value\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": true,
        "domain": "input_number",
        "service": "set_value",
        "x": 2500,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "095d2bf993964117",
        "type": "comment",
        "z": "479e3443afedb613",
        "g": "caf11d3b06226cb7",
        "name": "T√§glicher Reset",
        "info": "",
        "x": 1760,
        "y": 1160,
        "wires": []
    },
    {
        "id": "1f6df3bd52dc3303",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "33fc19028d8c92bf",
        "name": "Debugzeile bauen V2",
        "func": "// --- Kontextdaten lesen ---\nlet wrtyp = flow.get(\"WRTyp\");\nlet wrher = flow.get(\"WRHersteller\");\nlet wrmax = flow.get(\"WRLeistung\");\nlet wrmin = flow.get(\"WRminLeistung\");\nlet regler_aktiv = flow.get(\"ReglerAktiv\");\nlet termin_on = flow.get(\"Terminmodus\");\nlet max_einspeisung = flow.get(\"MaxEinspeisung\");\nlet soll = flow.get(\"Sollwert\");\nlet wr_aktiv = global.get(\"WRAktiv\");\nlet release = flow.get(\"Release\");\nlet wert1 = flow.get(\"Wert1\");\nlet wert2 = flow.get(\"Wert2\");\nlet wert3 = flow.get(\"Wert3\");\n//let isostring = new Date().toISOString();\n//let timestamp = new Date(isostring);\nlet timestamp = new Date().toLocaleString(\"de-DE\");\n\n// --- Erkennen, ob Fehler oder Status ---\nlet isError = msg.error !== undefined;\n\n// --- Felder f√ºr CSV ---\nlet logType = isError ? \"Error\" : \"Init\";\nlet nodeName = isError ? (msg.error?.source?.name || \"unknown\") : \"System\";\nlet nodeId = isError ? (msg.error?.source?.id || \"\") : \"\";\nlet nodeType = isError ? (msg.error?.source?.type || \"\") : \"\";\nlet message = isError ? (msg.error?.message || \"Unbekannter Fehler\") : \"Initialisierung erfolgreich\";\n\n// --- CSV-Zeile zusammenbauen ---\nmsg.payload =\n    `${timestamp};${logType};${nodeName};${nodeId};${nodeType};` +\n    `Release=${release};WRAusgang=${wrtyp};WRArt=${wrher};WRMax=${wrmax};WRMin=${wrmin};` +\n    `WRAktiv=${wr_aktiv};ReglerAktiv=${regler_aktiv};TerminMod=${termin_on};MaxEinspeisung=${max_einspeisung};` +\n    `Sollwert=${soll};Wert1Time=${wert1};Wert2Time=${wert2};Wert3Time=${wert3};${message}\\n`;\n\n// --- Status im Editor anzeigen ---\nnode.status({ text: `${logType} Log geschrieben` });\nsetTimeout(() => node.status({}), 3000);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 1900,
        "wires": [
            [
                "19c87395473efe5b"
            ]
        ]
    },
    {
        "id": "09573f0766e9b699",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "0ebb8e7b772678cd",
        "name": "WR Aktion2",
        "func": "const debug = flow.get(\"Debug\");\nlet { einspeisewert: regelwert } = msg.payload;\nconst wrmax = flow.get(\"WRLeistung\");\nconst wrtyp = flow.get(\"WRTyp\");\n\nif (debug) node.warn(`RegelwertWR=${regelwert}`);\n\nconst sensormap = {\n  1: \"wrSensor_typ1\",\n  2: \"wrSensor_typ2\",\n  3: \"wrSensor_typ3\",\n  4: \"wrSensor_typ4\"\n};\n\n// Berechne ggf. prozentualen Wert f√ºr Typ 2\nif (wrtyp === 2 && wrmax) regelwert = regelwert / wrmax * 100;\n\n// Hole zugeh√∂rigen Sensornamen\nconst zielSensor = flow.get(sensormap[wrtyp]);\n\nmsg.payload = { einspeisewert: regelwert, sensor: zielSensor };\n\n//node.status({ text: `Regelwert: ${regelwert}` });\n\nnode.status({\n  text: `WR-Typ: ${wrtyp} | Regelwert: ${regelwert}`\n});\nsetTimeout(() => node.status({}), 9000);\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 2000,
        "wires": [
            [
                "fc7613a47a09c1a6",
                "54372a43b72a9c3a"
            ]
        ]
    },
    {
        "id": "652351a92f1a3d4b",
        "type": "api-current-state",
        "z": "479e3443afedb613",
        "g": "b9d168c1fa77f22a",
        "name": "Terminmodus an?",
        "server": "285afb99.5208c4",
        "version": 3,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_boolean.regler_terminmodus",
        "state_type": "str",
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "originalpayload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 790,
        "y": 3100,
        "wires": [
            [
                "17d9fef67944a9b4",
                "909de9d9437f09c6"
            ],
            []
        ]
    },
    {
        "id": "270cd10ad54ddfd0",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "d7ce31319e5242a2",
        "name": "Test Whatsigram",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 340,
        "y": 4980,
        "wires": [
            [
                "4f98968ddf42865a"
            ]
        ]
    },
    {
        "id": "2569cad207b467f7",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "d7ce31319e5242a2",
        "name": "Sende Nachricht via WhatSigram",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "notify.send_message",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"message\":\"{{payload.message}}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "send_message",
        "target": {},
        "mergecontext": "",
        "x": 840,
        "y": 4980,
        "wires": [
            []
        ]
    },
    {
        "id": "4f98968ddf42865a",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "d7ce31319e5242a2",
        "name": "Aufbereitung",
        "func": "// let raw = msg.payload;\nlet raw = 20;\nlet messenger = \"notify.whatsigram_recipient_1\";\n\nmsg.payload = {\n  message: `Temperatur im Wohnzimmer: ${raw}¬∞C`,\n  sensor: messenger\n};\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 4980,
        "wires": [
            [
                "2569cad207b467f7"
            ]
        ]
    },
    {
        "id": "294af22fccee50c1",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Messenger",
        "func": "const messenger = flow.get (\"messenger\");\nconst msg_service = global.get (\"msgDienst\");\nlet isError = msg.error !== undefined;\nlet nodeName = isError ? (msg.error?.source?.name || \"unknown\") : \"System\";\nlet nachricht =  \"WR aus: \";\n\nif (messenger === \"on\") {\n  msg.payload = {\n    data: {\n      message: `‚ùå\\nNodeName: ${nodeName}\\nNachricht: ${nachricht}\\n`\n    },\n    sensor: msg_service\n  };\n  return msg;\n}\nelse {\n  return null;  // kein Output, wenn messenger \"off\" ist\n}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3210,
        "y": 2040,
        "wires": [
            [
                "0a77a411bae6d6a8"
            ]
        ]
    },
    {
        "id": "c731caca09ad7220",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2960,
        "y": 2040,
        "wires": [
            [
                "294af22fccee50c1"
            ]
        ]
    },
    {
        "id": "0a77a411bae6d6a8",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "b5ff1f69caf7f3fb",
        "name": "Sende Nachricht via WhatSigram",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "notify.send_message",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "send_message",
        "target": {},
        "mergecontext": "",
        "x": 3480,
        "y": 2040,
        "wires": [
            []
        ]
    },
    {
        "id": "3ac00ebeea2b8c5c",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "18:30",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 18 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1750,
        "y": 1660,
        "wires": [
            [
                "b41f6643294c0f56"
            ]
        ]
    },
    {
        "id": "939f0aa5e8a71cef",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "Neue DoC ermitteln",
        "func": "const pvfc=flow.get (\"PVForecast\");\nconst now = new Date();\nconst monat = now.getMonth() + 1;\n\n// Konfigurationstabelle f√ºr jeden Monat\nlet config = flow.get(\"ConfigValues\");\n\n// Variablen vor der Verwendung deklarieren\nlet akku_min =  flow.get(\"AbsoluteMinVol\");\nlet sollwert = flow.get(\"Sollwert\");\nlet maxeinspeisung =  flow.get(\"MaxEinspeisung\");\n\n// Wenn der Monat g√ºltig ist, Werte √ºbernehmen\nif (config && config[monat]) {\n    ({ akku_min, sollwert, maxeinspeisung } = config[monat]);\n} else {\n    node.warn(`Ung√ºltiger Monat: ${monat} ‚Äî Standardwerte werden verwendet`);\n}\n\n// Sensorname aus dem Flow-Speicher holen\nlet socsensor = flow.get(\"zHAMinSoCSensor\");\n\n// PV Forecast in Wh\nlet tomorrow = Number(msg.payload.fc) * 1000;\n\n// Eingestellte Entladegrenze\nconst socmin = Number(msg.payload.min);\n\n// Absolut Minimum Entladegrenze\nconst socminmin = flow.get(\"AbsoluteMinVol\");\n\n// aktuell konfigurierte Kapazit√§t der Akkus\nconst capacity = global.get(\"Capacity\");\n\n// wie tief ist die eingestellte Depth Of Charge des Akkus\nlet netto = Math.round(capacity * (100 - socmin) / 100);\n\nlet doc;\nlet newsocmin;\n\n// hier wird FC aus Erfahrungswerten justiert\ntomorrow = Math.round(tomorrow * 1.8);\n\n// Wenn der aktuelle FC gr√∂√üer ist als die aktuelle DoC ...\nif (tomorrow > netto) {\n    doc = Math.round(Math.min(tomorrow / capacity * 100, 100));\n    newsocmin = Math.min(Math.max(100 - doc, socminmin), akku_min);\n} else {\n    // keine √Ñnderung der Entladegrenze\n    newsocmin = socmin;\n}\n\nnode.status({\n    fill: \"yellow\",\n    shape: \"dot\",\n    text: `FC: ${tomorrow} | SocMin: ${socmin} | Netto: ${netto} | NewSocMin: ${newsocmin}`\n});\n\nif (pvfc === \"on\"){\n    msg = { payload: { value: newsocmin, sensor: socsensor } };\n    return msg}\nreturn;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2570,
        "y": 1660,
        "wires": [
            [
                "91a6dcfc70106acb"
            ]
        ]
    },
    {
        "id": "2d12daef02c4c242",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "Get MinSoc",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "zHAMinSoCSensor",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 2050,
        "y": 1620,
        "wires": [
            [
                "7e2bbff3fbeba74f"
            ]
        ]
    },
    {
        "id": "7e2bbff3fbeba74f",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "minSoc",
        "func": "let minsoc = Number(msg.payload[0].state);\nmsg.topic = \"min\";\nmsg.payload = minsoc;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Soc: \" +minsoc});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2220,
        "y": 1620,
        "wires": [
            [
                "e4d3edfa3d38398d"
            ]
        ]
    },
    {
        "id": "e4d3edfa3d38398d",
        "type": "join",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 2410,
        "y": 1660,
        "wires": [
            [
                "939f0aa5e8a71cef"
            ]
        ]
    },
    {
        "id": "9c6d4b41b2750d05",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "minVolSet",
        "func": "let minsoc = Number(msg.payload[0].state);\nmsg.topic = \"min\";\nmsg.payload = minsoc;\nnode.status({fill:\"green\",shape:\"ring\",text:\"Soc: \" +minsoc});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2360,
        "y": 1500,
        "wires": [
            [
                "9d729c1d1740d366"
            ]
        ]
    },
    {
        "id": "1327d2c0642ca6cc",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "c59bd969b0f7900c",
        "name": "MinSoc",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "zHAMinSoCSensor",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 2200,
        "y": 1500,
        "wires": [
            [
                "9c6d4b41b2750d05"
            ]
        ]
    },
    {
        "id": "91a6dcfc70106acb",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "Setze MinVol",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "number.set_value",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{\"value\": \"{{ payload.value }}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "blockInputOverrides": false,
        "domain": "number",
        "service": "set_value",
        "target": {
            "entity_id": "number.dtu_leistungsbegrenzung"
        },
        "x": 2770,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "fedc91bc44cbd434",
        "type": "ha-get-entities",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "Get PV Tomorrow",
        "server": "285afb99.5208c4",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "is",
                "value": "PV_tomorrow",
                "valueType": "flow"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 2050,
        "y": 1700,
        "wires": [
            [
                "62532c236f10aa32"
            ]
        ]
    },
    {
        "id": "62532c236f10aa32",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "PV Tomorrow",
        "func": "let tomorrow = Number(msg.payload[0].state);\nmsg.topic = \"fc\";\nmsg.payload = tomorrow;\nnode.status({fill:\"green\",shape:\"ring\",text:\"PV FC day: \" +tomorrow});\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 1700,
        "wires": [
            [
                "e4d3edfa3d38398d"
            ]
        ]
    },
    {
        "id": "b41f6643294c0f56",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "3f3b4e5f643e30d1",
        "name": "",
        "property": "PVForecast",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1870,
        "y": 1660,
        "wires": [
            [
                "fedc91bc44cbd434",
                "2d12daef02c4c242"
            ],
            []
        ]
    },
    {
        "id": "f539cfde4411e802",
        "type": "switch",
        "z": "479e3443afedb613",
        "g": "46a88bad508d3778",
        "name": "EinspeiseSensorExist?",
        "property": "EinspeiseSensorExist",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 2100,
        "wires": [
            [
                "1f11ef02984634d4"
            ],
            [
                "2c22eb5a28b88af3"
            ]
        ]
    },
    {
        "id": "a10e19704f6f0128",
        "type": "api-call-service",
        "z": "479e3443afedb613",
        "g": "50b4f58a24c2f256",
        "name": "Sende Nachricht via WhatSigram",
        "server": "285afb99.5208c4",
        "version": 7,
        "debugenabled": false,
        "action": "notify.send_message",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{ payload.sensor }}"
        ],
        "labelId": [],
        "data": "{}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "send_message",
        "mergecontext": "",
        "x": 860,
        "y": 4880,
        "wires": [
            []
        ]
    },
    {
        "id": "3405486d31eae70f",
        "type": "function",
        "z": "479e3443afedb613",
        "g": "50b4f58a24c2f256",
        "name": "Build Notify Message",
        "func": "// Flow-Variablen abrufen\nconst msg_service = global.get(\"msgDienst\");\nconst messenger = flow.get(\"messenger\");\n\nconst sollwert = flow.get(\"Sollwert\");\nconst actor = flow.get(\"actor\")\nconst aktiv = flow.get (\"ReglerAktiv\");\nconst maxeinspeisung = flow.get(\"MaxEinspeisung\") || 0;\nlet connected = flow.get(\"Connected\") === 0 ? \"offline\" : \"online\";\n\n// Nachricht zusammenbauen\nif (messenger === \"on\") {\n    msg.payload = {\n    data:   {\n        message: `‚öôÔ∏è\\nReglertyp: ${actor}\\nHub Online: ${connected}\\nRegelung aktiv: ${aktiv}\\nSollwert: ${sollwert} W\\nMax. Einspeisung: ${maxeinspeisung} W`\n            },\n    sensor: msg_service\n    };\n    return msg;\n    } \nelse \n    {\n    return null;  // kein Output, wenn messenger \"off\" ist\n    }",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 4880,
        "wires": [
            [
                "a10e19704f6f0128"
            ]
        ]
    },
    {
        "id": "6510f41ac1c3a100",
        "type": "inject",
        "z": "479e3443afedb613",
        "g": "50b4f58a24c2f256",
        "name": "Test",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 310,
        "y": 4880,
        "wires": [
            [
                "3405486d31eae70f"
            ]
        ]
    },
    {
        "id": "285afb99.5208c4",
        "type": "server",
        "name": "Home Assistant",
        "addon": true,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "",
        "connectionDelay": false,
        "cacheJson": false,
        "heartbeat": false,
        "heartbeatInterval": "",
        "statusSeparator": "",
        "enableGlobalContextStore": false
    }
]
